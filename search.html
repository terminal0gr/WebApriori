<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130197414-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130197414-2');
    </script>

    <!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	
	<!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"/> -->
	<link rel="stylesheet" type="text/css" href="DataTables/DataTables-1.10.20/css/jquery.dataTables.min.css"/>

	<link rel="stylesheet" href="css/styles.css" type="text/css" />
	<link rel="stylesheet" href="css/switch.css" type="text/css" />
	
	<script src="scripts/jquery-3.7.1.js"></script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

	<script type="text/javascript" src="DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>

	<script src="scripts/scripts.js"></script>

	<!-- Used for formulas -->
	<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>


    <link rel="icon" type="image/png" href="images/basketwhite.png"/>

    <title>AutoML WebApriori Association rules mining</title>

	<script>

		var resultsTable;
		var ajaxReq;
		var tmpHtml;
		var askForSaveParticipatingItems=false;
		var datasetMetadata;

		$(function() {

			// initialization of tooltips in page
			const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        	const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

			if (!sessionStorage.getItem('token') || sessionStorage.getItem('token')==0) {
				MyModal("WebApriori",'Please Sign in, or Sign up if you are a new user, in order to use our new association rules mining engine!');
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
			}

			if (sessionStorage.getItem('version')) {
				$('#navbar-brand').html('<img class="d-inline-block me-1" src="./images/basketwhite.svg" width="24" height="24" alt="">   ' + sessionStorage.getItem('ApplName') + ' ' +  sessionStorage.getItem('version'));
			}
			else {
				sessionStorage.clear();
				window.location.href='index.html';
			}
			M_F();
			VT();
			footerActions();

            if (sessionStorage.getItem('administrator') && sessionStorage.getItem('administrator')==1) {
                $('#grandPublicDatasets').show();
				//document.getElementById('grandPublicDatasets').style.display = 'block';
            }else{
                $('#grandPublicDatasets').hide();
				//document.getElementById('grandPublicDatasets').style.display = 'none';
            }

			if (sessionStorage.getItem('grandPublicDatasets') && sessionStorage.getItem('grandPublicDatasets')==1) {
				$('#publicDataset').show();
				//document.getElementById('publicDataset').style.display = 'block';
            }else{
                $('#publicDataset').hide();
				//document.getElementById('publicDataset').style.display = 'none';
            }

			GetDatasetFilelist();	

			$('#SignOut').click(function() {
				sessionStorage.clear();
				window.location.href='index.html';
			});		

			$('#uploadDatasetform').submit(function(e) {
				// Stop the browser from submitting the form.
				e.preventDefault();

				//Prepare the data to send
				var formData = new FormData();
				var fileSelect = document.getElementById("fileToUpload");
				if(fileSelect.files && fileSelect.files.length == 1){
                    var file = fileSelect.files[0]
					formData.set("fileToUpload", file , file.name);
				}
				else {
					MyModal("Information", "You have not chosen a file for upload.<br>Please choose one.");
					return;
				}
				var datasetType = document.getElementById("datasetType");
				if(!datasetType.value){
					MyModal("Information", "You have not chosen datasetType!!!");
					return;
				}
				formData.set("datasetType", datasetType.value);
				if (sessionStorage.getItem('token')) {
					formData.set("token",sessionStorage.getItem('token'));
				}
				else {
					MyModal("Error", "You are not signed in!!! Please sign in/up");
					return;
				}
				
				formData.set("isPublic", $("#isPublicCheckbox").is(":checked"));

				// Submit the form using AJAX.
				ajaxReq = $.ajax({
					type: 'POST',
					url: $('#uploadDatasetform').attr('action'),
					contentType: false,
                    cache: false,
                    processData:false,
					data: formData,
					beforeSend: function( xhr ) {
						tmpHtml=$('#uploadDataset').html();
						$('#uploadDataset').removeClass( "btn-primary" ).addClass("btn-warning").html('<div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>');	
  					}
				}).done(function(response, textStatus, jqXHR) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						if (jqXHR.status==200) {
							MyModal(res.title,res.message);
							GetDatasetFilelist();
						} else {
							MyModal(res.title, res.message);
						}
					}
					else alert(response);
				}).fail(function( jqXHR, textStatus, thrownError ) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					} 
					else MyModal("Error", jqXHR.responseText);
				}).always(function() {
					$('#uploadDataset').removeClass("btn-warning").addClass("btn-primary").html(tmpHtml);
				});
			});

			// Set up an event listener for the form.
			ajaxReq = $('#retrieveRules').submit(function(e) {
				// Stop the browser from submitting the form.
				e.preventDefault();

				if ($('#submitBtn').hasClass("btn-warning")) {
					ajaxReq.abort();
					ajaxreq=undefined;
					MyModal("Exclamation","Function aborted by user.");
					return;
				};

				//Prepare the data to send
				var dataset = document.getElementById("dataset");
				if(!dataset.value){
					MyModal("Information", "Please choose a dataset!!!");
					return;
				}

				var datasetType = document.getElementById("datasetType").value;
				if (datasetType=="0") {
					MyModal("Information", "This dataset (0 - Unmanaged dataset Type  can't be used for frequent itemsets or useful association rules.");
					return;
				}

				//If the participating items filter is shown then save changes and hide it
				const elementName='#itemsSelection'
				if ($(elementName).is(":visible")) {
					saveParticipatingItems(false);
   					$(elementName).hide( "slow" );
				}	

				// Serialize the form data first in array form so to add more elements.
				var formData = $('#retrieveRules').serializeArray(); // convert form to array


				//If the dataset is of type 2 it is mandatory to have Group Item and Value Item declared
				if (datasetType=="2") {
					let textboxValue = document.getElementById("groupItem").value;
					if (!textboxValue || textboxValue=="?") {
					   	MyModal("Information", "It is mandatory to declare the grouping field/item/column in the dataset that represents the primary key for a given transaction when type 2 (INV) dataset is used.");
						document.getElementById("groupItem").focus();
					 	return;
					}
					formData.push({name: "groupItem", value: textboxValue});

					textboxValue = document.getElementById("valueItem").value;
					if (!textboxValue || textboxValue=="?") {
					   	MyModal("Information", "It is mandatory to declare the value field/item/column which represents the items participating in ARM when type 2 (INV) dataset is used.");
						document.getElementById("valueItem").focus();
					 	return;
					}
					formData.push({name: "valueItem", value: textboxValue});
				}

				//For Dataset type 3 is not neccessary to do extra steps in order to update formData
				//because the absent value which is the unique value for type 3-SI is automatically included via the html form.

				//header existence
				hd1=0;
				if ($("#header1").is(":checked")) hd1=1;
				formData.push({name: "header1", value: hd1});

				formData.push({name: "datasetType", value: document.getElementById('datasetType').value});

				if (document.getElementById('datasetType').value) {
					formData.push({name: "groupItem", value: document.getElementById('groupItem').value});
					formData.push({name: "valueItem", value: document.getElementById('valueItem').value});
				}

                //Redundant rules process
				bws=0;
				if ($("#Redundant1").is(":checked")) bws+=1;
				if ($("#Redundant2").is(":checked")) bws+=2;			
				if ($("#Redundant3").is(":checked")) bws+=4;		
				formData.push({name: "redundantType", value: bws});

				if (sessionStorage.getItem('token')) {
					formData.push({name: "token", value: sessionStorage.getItem('token')});
				}
				else {
					MyModal("Error", "You are not signed in!!! Please sign in/up");
					return;
				}

				// Submit the form using AJAX.
				ajaxReq= $.ajax({
					type: 'POST',
					url: $('#retrieveRules').attr('action'),
					data: $.param(formData), //serialize 	the array
					beforeSend: function( xhr ) {
						$('#showResults').hide("slow");
						//$( "p" ).removeClass( "myClass noClass" ).addClass( "yourClass" );
						$('#submitBtn').html("<b>Retrieving rules. Click to abort</b>").removeClass( "btn-primary" ).addClass("btn-warning");	
  					}
				})
				.done(function(response, textStatus, jqXHR) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						if (jqXHR.status!=200) {
							MyModal(res.title, res.message);
						} else {					
							try {
								if (isJSON(res.message)) { 
									resm=JSON.parse(res.message);
									fillTable(resm);
									if (res.error_text) {
										MyModal("Warning" , res.error_text);
									}
								} else {
									if (res.message) {
										MyModal("Error 10" , res.message);
									} else {
										return;
									}
								}
							} catch(err){
								MyModal("Error 20<br>" + err.message, res.message);
								return;
							}
						} 
					}
					else alert(response);
				})
				.fail(function(jqXHR) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						if (res.title || res.message) {
							MyModal(res.title, res.message);
						}
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					} 
					if (jqXHR.responseText) {
						MyModal("Error 30", jqXHR.responseText);						
					} else {
						return;
					}
				})
				.always(function() {
					$('#submitBtn').html("Retrieve association rules").removeClass("btn-warning").addClass("btn-primary");
				});
			});

		});

        function fillTable(jsonData) {

			$('#Records').val(jsonData.Records)
			$('#RecordsCreationTime').val(jsonData.RecordsCreationTime + ' seconds')
			$('#RulesCount').val(jsonData.RulesCount)
			$('#RulesCreationTime').val(jsonData.RulesCreationTime + ' seconds')			

			if (resultsTable) {
				resultsTable.clear().rows.add(jsonData.rules).draw();
			} else {
				resultsTable = $('#showResultsTbl').DataTable( {
					stateSave: true,
					data: jsonData.rules,
					columns: [
						{ "title" : "#",
							"data"  : function ( row, type, val, meta ) {
							return meta.row+1;
							}},
						{ "title" : "LHS/Body",
							"data"  : "LHS",
							"render": "[, ]" },
						{ "title" : "LHS Count/Sup",
							"data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.LHS_Count + ' / ' + row.LHS_Support.toFixed(3);
								}
								else {
									return row.LHS_Count
								};
							} },
						{ "title" : "RHS/Head",
							"data"  : "RHS",
							"render": "[, ]" },
						{ "title" : "RHS Count/Sup",
							"data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.RHS_Count + ' / ' + row.RHS_Support.toFixed(3);
								}
								else {
									return row.RHS_Count
								};
							} },
						{ "title" : "Rule Count/Sup",
						  "data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.Count + ' / ' + row.Support.toFixed(3);
								}
								else {
									return row.Count
								};
							} },									 
						{ "title" : "Confidence",
							"data"  : "Confidence",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },
						{ "title" : "Lift",
							"data"  : "Lift",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },										
						{ "title" : "Conviction",
							"data"  : "Conviction",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },
						{ "title" : "Leverage",
							"data"  : "Leverage",
							"render": function ( data, type, row, meta ) {
								if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} 
						},
					]
				} );
			};
			$("#showResults").show("slow");
		};

		function GetDatasetFilelist() {
			var formData = new FormData();
			if (sessionStorage.getItem('token')) {
				formData.set("token",sessionStorage.getItem('token'));
			}
			else {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				return;
			}

			$.ajax({
				type: 'POST' ,
				url: 'phpfunctions/retrieveDatasetFilelist.php',
				contentType: false,
                cache: false,
                processData:false ,
			    data: formData
			}) 	
			.done(function(response) {
				if (isJSON(response)) {
					res=JSON.parse(response);
					try {
						str='<option value="" disabled selected >Choose a dataset or click to the link to upload a new one</option>';
						res.forEach(function(data, index){
							if (data.public===0) {
								str += '<option value="' + data.filename + '">' + data.filename + '</option>' 
							}else{
								str += '<option value="' + 'p|' + data.filename + '" style="background-color: powderblue;">(public) ' + data.filename + '</option>' 
							}	  
						});
						$("#dataset").html(str);
					}
					catch(err) {
						MyModal("Error", err.message);
					}
				}
				else {
					if (response) {
						MyModal("Error", response);
					}
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("association rules",'Unknown error occured!');
				}
			});
		};

        // It handles the footer when the size of the window changes.
        function M_F() {
			if ($(window).width() <= 600) {
				$('.udfwidth').css("width", "98%");
			}
			else if ($(window).width() > 600 && $(window).width() <= 1500) {
				var pos1=Math.round(Math.abs($(window).width()-1500)*0.055+50);
				$('.udfwidth').css("width", pos1 + "%");
			}
			else {	
				$('.udfwidth').css("width", "50%");
			}
			style="width: 329px;"
            if ($(window).width() <= 800 || $(window).height() <= 600) {
                $('#c-footer').removeClass('fixed-bottom');
            }
            else {
                $('#c-footer').addClass('fixed-bottom')
            }
        };

        // handle the interface when guest or logged in
        function VT() {
            if (sessionStorage.getItem('token') && sessionStorage.getItem('token')!='0') {
                $('#SignUp').hide();
				$('#SignIn').hide();
                if (sessionStorage.getItem('username')) {
                    $('#person').html('<img src="images/person24.png" alt="p">' + sessionStorage.getItem('username'));
                    $('#person').show;
                } else {
                    $('#person').hide;
                }                    
                $('#sdropdown').show();
            } else {
                $('#SignUp').show();
                $('#SignIn').show();
                $('#sdropdown').hide();
			}
			
			if (sessionStorage.getItem('administrator') && sessionStorage.getItem('administrator')==1) {
                $('#grandPublicDatasets').show();
            }else{
                $('#grandPublicDatasets').hide();
            }
        };

        $( window ).resize(function() {
            M_F();
        });		
		
		function UploadDataset() {
			if ($('#uploadDatasetform').is(":visible")) {
				$('#uploadDatasetform').hide( "slow" );
			}
			else {
				$('#uploadDatasetform').show( "slow" );
			}
		};

		function deletecurrentDataset() {
			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			var x = document.getElementById("dataset");
			if (!x.value) {
				MyModal("Information","No dataset to delete.");
				return;
			}
			pbl=x.value.substr(0,2);	
			if (pbl=="p|") {
				pbl="public dataset " + x.value.substr(3);
			}else{
				pbl="dataset " + x.value.substr(1);
			}
			if (confirm("Are you sure you want to delete " + pbl + ";")){
				var formData = new FormData();
				formData.set("token",sessionStorage.getItem('token'));
				formData.set("dataset",x.value);
				$.ajax({
					type: 'POST' ,
					url: 'phpfunctions/deleteDataset.php',
					data: formData,
					contentType: false,
                	cache: false,
                	processData:false
				}) 	
				.done(function(response) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						try {
							GetDatasetFilelist();
						}
						catch(err) {
							MyModal("Error", err.message);
						}
					}
					else {
						MyModal("Error", response);
					}
				}).fail(function( jqXHR, textStatus, thrownError ) {
					if (jqXHR.responseText) {
						if (isJSON(jqXHR.responseText)) {
							res=JSON.parse(jqXHR.responseText);
							MyModal(res.title, res.message);
							if ( jqXHR.status>=400) {
								setTimeout(function() {
									sessionStorage.clear();
									window.location.href='index.html';
								}, 3000);	
							}
						}
						else alert(jqXHR.responseText);
					} else {
						MyModal("WebApriori",'Unknown error occured!');
					}
				});
			}
		};

		function retrieveInputParameters() {

			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			var x = document.getElementById("dataset");
			if (!x.value) {
				return;
			}

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",x.value);
			$.ajax({
				type: 'POST' ,
				url: 'phpfunctions/retrieveInputParameters.php',
				data: formData,
				contentType: false,
				cache: false,
				processData:false,
				beforeSend: function( xhr ) {
					$('#showResults').hide("slow");
					$('#submitBtn').html("<b>Retrieving last mining for this dataset.<br>Please wait...</b>").removeClass( "btn-primary" ).addClass("btn-warning");	
  				}
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstanses and if it is a JSON obj
				if (response!=undefined && response!=null && isJSON(response)) {
					res=JSON.parse(response);
					try {
						if (jqXHR.status!=200) {
							// not found input parameters
                            $("#showResults").hide();
						} else {
							document.getElementById('min_support').value=res.min_support; 
							document.getElementById('min_confidence').value=res.min_confidence; 
							document.getElementById('min_lift').value=res.min_lift; 
							document.getElementById('max_length').value=res.max_length; 

							if (typeof res.reduntantRemoveType !== 'undefined') {
								document.getElementById("Redundant1").checked=(res.reduntantRemoveType & 1) == 1
								document.getElementById("Redundant2").checked=(res.reduntantRemoveType & 2) == 2
								document.getElementById("Redundant3").checked=(res.reduntantRemoveType & 4) == 4
							} else {
								document.getElementById("Redundant1").checked=false;
								document.getElementById("Redundant2").checked=false;
								document.getElementById("Redundant3").checked=false;
							}

							//Todo: Fill the user item choices here...

							fillTable(res);
						}
					}
					catch(err) {
						MyModal("Error", err.message);
					}
				}
				else {
					//cover both null and undefined circumstanses
					if (response!=undefined && response!=null) {
						MyModal("Error", response);
					} else {
						MyModal("Error", "Unknown error occured");
					}
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("association rules",'Unknown error occured!');
				}
			}).always(function() {
				$('#submitBtn').html("Retrieve association rules").removeClass("btn-warning").addClass("btn-primary");
			});
		};

		function DoDownload(kind="result") {
			var str='phpfunctions/download.php?'
			const data = { 'token': sessionStorage.getItem('token'), 
			               'dataset': document.getElementById("dataset").value,
						   'kind': kind };
			const ret = [];
   			for (let d in data)
     			ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
   			str+=ret.join('&');

			window.location=str;
		};

		function autoDetectDatasetAttr(forceAutoDetect=false) {
			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			var x = document.getElementById("dataset");
			if (!x.value) {
				MyModal("Information", "No dataset has been selected!")
				return;
			}

			// If the dataset info div is open the close it first.
			const element = document.getElementById('datasetDescribe');
			if (!isElementHidden(element)) {
				toggleDisplay('#datasetDescribe');
			}

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",x.value);
			formData.set("forceAutoDetect",forceAutoDetect)

			$.ajax({
				type: 'POST' ,
				url: 'phpfunctions/datasetAttrAutoDetect.php',
				data: formData,
				contentType: false,
				cache: false,
				processData:false,
				beforeSend: function( xhr ) {
					var element = document.getElementById('DatasetAttrSection');
					element.className="d-none";
					var element = document.getElementById('autoDetect1');
					element.classList.add("d-none");
					element.classList.remove("d-block");
					element = document.getElementById('autoDetecting');
					element.classList.add("d-block");
					element.classList.remove("d-none");
					//Show spinner while waiting
					element = document.getElementById('datasetInfo');
					element.classList.add("d-none");
					element.classList.remove("d-block");
					element = document.getElementById('datasetInfoSpinner');
					element.classList.add("d-block");
					element.classList.remove("d-none");			
				}
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstances and if it is a JSON obj
				if (response!=undefined && response!=null && isJSON(response)) {
					res=JSON.parse(response);
					try {
						if (jqXHR.status!=200) {
							MyModal(jqXHR.status + ' - ' + res.title, res.message);
						} else {
							//Make it global
							datasetMetadata=res

							if (res.delimiter=='\t') {
								document.getElementById('separator').value='{TAB}'
							} else {
								document.getElementById('separator').value=res.delimiter; 
							}

							document.getElementById("header1").checked=res.hasHeader; 

							document.getElementById("datasetType").value=res.datasetType;
							datasetTypeChanged();

							if (res.datasetType==2) {
								InitializeDatasetType2();
							}

							if (res.datasetType==3) {
								document.getElementById("absentValue").value=res.absentValue
							}
                            
						}
					}
					catch(err) {
						MyModal("Error1", err.message);
					}
				}
				else {
					//cover both null and undefined circumstances
					if (response!=undefined && response!=null) {
						MyModal("Error", response);
					} else {
						MyModal("Error", "Unknown error occured");
					}
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("association rules",'Unknown error occured!');
				}
			}).always(function() {
				var element = document.getElementById('DatasetAttrSection');
				element.className="";
				var element = document.getElementById('autoDetecting');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				element = document.getElementById('autoDetect1');
				element.classList.add("d-block");
				element.classList.remove("d-none");	
				//Show spinner while waiting
				element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-block");
				element.classList.remove("d-none");			
			});
		};

		function InitializeDatasetType2() {
			str='<option value="" disabled selected >?</option>';
			if (!datasetMetadata) {
				MyModal("exclamation",'Could not initialize dataset type 2. Please execute the Autodetect link and retry.');
				return;
			}

			datasetMetadata.header.forEach(function(data){
				str += '<option value="' + data + '">' + data + '</option>' ;
			});
			$("#groupItem").html(str);
			$("#valueItem").html(str);

			document.getElementById('groupItem').value=datasetMetadata.groupItem;
			document.getElementById('valueItem').value=datasetMetadata.valueItem;
		}

		function InitializeDatasetType3() {
			if (!datasetMetadata) {
				MyModal("exclamation",'Could not initialize dataset type 3. Please execute the Autodetect link and retry.');
				return;
			}
			if (typeof datasetMetadata.datasetFeatures=='undefined'){
				MyModal("exclamation",'Could not initialize dataset type 3. Please execute the Autodetect link and retry.');
				return;
			}
            document.getElementById('absentValue').value=datasetMetadata.datasetFeatures["Top1Value"][1];
		}


		function clearDatasetAttr() {
			
			document.getElementById('min_support').value="0.01"; 
			document.getElementById('min_confidence').value="0.2"; 
			document.getElementById('min_lift').value="1.5"; 
			document.getElementById('max_length').value="4"; 

			document.getElementById('separator').value=";"; 
			document.getElementById("header1").checked=false; 

			document.getElementById('absentValue').value="";
			document.getElementById('groupItem').value="?";
			document.getElementById('valueItem').value="?";

			element=document.getElementById("datasetDescribe");
            if (!isElementHidden(element)) {
	        	toggleDisplay('#datasetDescribe');
			}
		}

		// Function to render JSON data into the table
		function renderTable(renderOnly=false) {

			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			element=document.getElementById("datasetDescribe");

			if (!renderOnly) {
			//If datasetDescribe is shown the just hide it
				if (!isElementHidden(element)) {
					toggleDisplay('#datasetDescribe');
					return;
				}
			}

			//Check if user has chosen any dataset.
			var dataset =  document.getElementById("dataset");
			if(!dataset.value){
				MyModal("Information", "No dataset has been selected!");
				return;
			}

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",dataset.value);
			formData.set('rows', document.getElementById("NRows").value);
			formData.set('columns',document.getElementById("NCols").value);
			formData.set('hasHeader', document.getElementById("header1").checked);
			formData.set("delimiter",document.getElementById('separator').value);
			formData.set("datasetType", document.getElementById('datasetType').value);
			if (document.getElementById('datasetType').value==2) {
				formData.set("groupItem", document.getElementById('groupItem').value);
				formData.set("valueItem", document.getElementById('valueItem').value);
			} else if (document.getElementById('datasetType').value==3) {
				formData.set("absentValue", document.getElementById('absentValue').value);
			}

			$.ajax({
				url: 'phpfunctions/datasetDescribe.php',
				method: 'POST',
				dataType: 'json',
				data: formData,
				contentType: false,
				cache: false,
				processData:false,

				beforeSend: function( xhr ) {
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-block");
				element.classList.remove("d-none");
				}
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstances and if it is a JSON obj
				if (response!=undefined && response!=null) {
					res=response;
					try {
						res=JSON.parse(res);
					}
					catch {}

					try {
						if (jqXHR.status!=200) {
							MyModal(res.title + '(' + jqXHR.status + ')', res.message);
						}
						else {	

							//Dataset Features Loading Segment
							var jsonData = res.features;
							if (jsonData==undefined) {
								MyModal("Invalid information!", "Could not retrieve dataset information properly");
								return;
							}
							else {
								var featuresList = document.getElementById('datasetFeaturesDiv');
								featuresList.innerHTML="";

								for (const key in jsonData) {
									// Create a new div element with the class "col" and populate it with key-value pairs from jsonData
									const newDiv = document.createElement("div");

									if (key=="datasetType"){
										if (jsonData[key][1]==jsonData["datasetTypePredicted"][1]) {
											newDiv.className = "col text-bg-primary border";
										} else {
											newDiv.className = "col text-bg-warning border";
										}
									} else if  (key=="datasetTypePredicted"){
										newDiv.className = "col text-bg-primary border";
									} else if (jsonData[key][3].includes("ARM process")) {
										newDiv.className = "col text-bg-success border";
									} else{
										newDiv.className = "col text-bg-secondary border";
									}

									newDiv.setAttribute('tabindex',"0");
									newDiv.setAttribute('data-bs-toggle', "tooltip");
									newDiv.setAttribute('data-bs-title', jsonData[key][3]);
									newDiv.setAttribute('data-bs-delay', '{"show":800,"hide":100}');
									newDiv.innerHTML = jsonData[key][0] + '<br>' + jsonData[key][2];
									// Append the new div element to the row
									featuresList.appendChild(newDiv);
								}
								$('#datasetFeaturesDiv').find('[data-bs-toggle="tooltip"]').tooltip();
							}	


							//First dataset lines Loading Segment
							var jsonData = res.Head
							if (jsonData==undefined) {
								MyModal("Invalid information!", "Could not retrieve dataset information properly");
								return;
							}

							var tableHead = $('#dD1TableHeader');
							tableHead.empty();

							const keys = Object.keys(jsonData[0]);

							// If the dataset has Header --> res.features['hasHeader'][1]
							if (res.features['hasHeader'][1]) {

								var row = $('<tr><th class="text-end">#</th></tr>');
								// Loop through each key
								keys.forEach(key => {
									row.append('<th>' + key + '</th>');
								});
								tableHead.append(row);
							}

							var tableBody = $('#data-table-body');
							tableBody.empty(); // Clear any existing rows

							// Loop through each item in the JSON data
							//jsonData.forEach(function(item) {
							jsonData.forEach((item,index) => {
								var row = $(`<tr><td class="text-end">${index+1}</td></tr>`);

								keys.forEach(key => {
									if (res.features['datasetType'][1]==1 && (item[key] === null || item[key]=='NaN')) {
										//If the dataset type is 1-MBL then we don't want to see 'NaN' at the end of each transaction. So we show nothing 
										row.append('<td></td>');
									} else {
										row.append('<td>' + item[key] + '</td>');
									}
								});
								tableBody.append(row);
							});

							if (!renderOnly) {
								toggleDisplay('#datasetDescribe');
							}

						}
						return;
					}
					catch(err) {
						MyModal("Error1", err.message);
						return;
					}
				}
				else {
					MyModal("Error", "Unknown error occured");
					return;
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("Error",'Unknown error occured!');
					return;
				}
			}).always(function() {
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-block");
				element.classList.remove("d-none");		
			});					
		}

		function changeRowsAndCols() {
			renderTable(true);
		}

		function itemFilter(itemName, value=0) {

			// Create the main div element
			var mainDiv = document.createElement('div');
			mainDiv.className = 'col text-bg-secondary border';
			//mainDiv.tabIndex = 0;

			// Create the h6 element
			var h6 = document.createElement('h6');
			h6.className = 'text-warning text-nowrap';
			h6.setAttribute('tabindex',"0");
			h6.setAttribute('data-bs-toggle', 'tooltip');
			h6.setAttribute('data-bs-delay', '{"show":800,"hide":100}');
			h6.setAttribute('data-bs-title', itemName);
			h6.textContent = itemName;
			mainDiv.appendChild(h6);

			// Function to create form-check elements
			function createFormCheck(groupId, inputId, labelContent, isChecked = false) {
				var formCheckDiv = document.createElement('div');
				formCheckDiv.className = 'form-check';

				var input = document.createElement('input');
				input.className = 'form-check-input';
				input.type = 'radio';
				input.name = groupId;
				input.id = inputId;
				if (isChecked) {
					input.checked = true;
				}

				var label = document.createElement('label');
				label.className = 'form-check-label';
				label.htmlFor = inputId;
				label.textContent = labelContent;

				formCheckDiv.appendChild(input);
				formCheckDiv.appendChild(label);

				return formCheckDiv;
			}

			// Create and append form-check elements
			switch (value) {
				case 1:
					mainDiv.appendChild(createFormCheck(itemName, itemName + '0', 'Included'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '1', 'Only in LHS', true));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '2', 'Only in RHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '3', 'Excluded'));
					break;
				case 2:
					mainDiv.appendChild(createFormCheck(itemName, itemName + '0', 'Included'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '1', 'Only in LHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '2', 'Only in RHS', true));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '3', 'Excluded'));
					break;
				case 3:
					mainDiv.appendChild(createFormCheck(itemName, itemName + '0', 'Included'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '1', 'Only in LHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '2', 'Only in RHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '3', 'Excluded', true));
					break;
				default:
					mainDiv.appendChild(createFormCheck(itemName, itemName + '0', 'Included', true));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '1', 'Only in LHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '2', 'Only in RHS'));
					mainDiv.appendChild(createFormCheck(itemName, itemName + '3', 'Excluded'));
					break;
			}

			itemsSelectionDiv.appendChild(mainDiv);

		}

		function retrieveParticipatingItems(reInitialize=false) {

			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			//Check if user has chosen any dataset.
			var dataset =  document.getElementById("dataset");
			if(!dataset.value){
				MyModal("Information", "No dataset has been selected!");
				return;
			}

			const datasetType=document.getElementById("datasetType").value;
			if (datasetType==0) {
				MyModal("Information", "The dataset is classified as type 0-Unmanaged, so its items cannot be retrieved.");
				return;			
			}

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",dataset.value);
			formData.set("datasetType",datasetType);
			if (reInitialize) {
				formData.set("reInitialize",true);
			}

			let textboxValue = '';

			switch (datasetType) {
				case '2':

					textboxValue = document.getElementById("groupItem").value;
					if (!textboxValue || textboxValue=="?") {
					   	MyModal("Information", "It is mandatory to declare the grouping field/item/column in the dataset that represents the primary key for a given transaction when type 2 (INV) dataset is used.");
						document.getElementById("groupItem").focus();
					 	return;
					}
					formData.set("groupItem",textboxValue);

					textboxValue = document.getElementById("valueItem").value;
					if (!textboxValue || textboxValue=="?") {
					   	MyModal("Information", "It is mandatory to declare the value field/item/column which represents the items participating in ARM when type 2 (INV) dataset is used.");
						document.getElementById("valueItem").focus();
					 	return;
					}
					formData.set("valueItem",textboxValue);
					break;			
				case '3':

   					textboxValue = document.getElementById("absentValue").value;
					if (!textboxValue) {
					   	MyModal("Information", "It is mandatory to declare the absent value in ARM when type 3 (SI) dataset is used.");
						document.getElementById("absentValue").focus();
					 	return;
					}
					formData.set("absentValue",textboxValue);
					break;			
			}

			$.ajax({
				url: 'phpfunctions/retrieveParticipatingItems.php',
				method: 'POST',
				dataType: 'json',
				data: formData,
				contentType: false,
				cache: false,
				processData:false,

				beforeSend: function( xhr ) {
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-block");
				element.classList.remove("d-none");
				}
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstances and if it is a JSON obj
				if (response!=undefined && response!=null) {
					res=response;

					try {
						if (jqXHR.status!=200) {
							MyModal(res.title + '(' + jqXHR.status + ')', res.message);
						}
						else {	

							try {
								res=JSON.parse(res.message);
							}
							catch(err) {
								MyModal("Error2", err.message + res);
								return;
							}

							itemsSelectionDiv.innerHTML="";

							// Iterate over the object using a for...in loop
							for (const key in res) {
  								if (res.hasOwnProperty(key)) {
									itemFilter(key,res[key]);
								}
							}

							// res.forEach(function(data) {
							// 	itemFilter(data);
							// });

							const elementName='#itemsSelection'
							$(elementName).find('[data-bs-toggle="tooltip"]').tooltip();
							if (!$(elementName).is(":visible")) {
            					$(elementName).show( "slow" );
							}	
							
						}
					}
					catch(err) {
						MyModal("Error1", err.message);
						return;
					}
				}
				else {
					MyModal("Error", "Unknown error occured");
					return;
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("Error",'Unknown error occured!');
					return;
				}
			}).always(function() {
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-block");
				element.classList.remove("d-none");		
			});					
		}
			
		function saveParticipatingItems(ShowMessages=true) {

			//Check if user has chosen any dataset.
			var dataset =  document.getElementById("dataset");
			if(!dataset.value){
				MyModal("Info function aborted!", "No dataset has been selected!");
				return;
			}

			let parentElement = document.getElementById("itemsSelectionDiv");
			let children = parentElement.children;

			// Initialize an empty object
			let excludedItems = {};

			for (let i = 0; i < children.length; i++) {

				for (let j=2; j<children[i].children.length; j++) {
					if (children[i].children[j].children[0].checked==true) {
						excludedItems[children[i].children[0].innerText]=j-1;
					}
				}
			}			

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",dataset.value);
			if (Object.keys(excludedItems).length>0) {
				excludedItems = JSON.stringify(excludedItems);
				formData.set("excludedParticipatingItems",excludedItems);
			}

			$.ajax({
				url: 'phpfunctions/saveParticipatingItems.php',
				method: 'POST',
				dataType: 'json',
				data: formData,
				contentType: false,
				cache: false,
				processData:false,

				beforeSend: function( xhr ) {
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-block");
				element.classList.remove("d-none");
				}
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstances and if it is a JSON obj
				if (response!=undefined && response!=null) {
					res=response;
					if (jqXHR.status!=200) {
						try {
							MyModal(res.title + ' (' + jqXHR.status + ')', res.message);
						}
						catch(err) {
							MyModal("Error1", err.message);
							return;
						} 
					} else {
						try {
							if (ShowMessages) {
								MyModal(res.title, res.message);
							}
						}
						catch(err) {
							MyModal("Error1", err.message);
							return;
						}
					}
				} else {
					MyModal("Error", "Unknown error occured");
					return;
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("Error",'Unknown error occured!');
					return;
				}
			}).always(function() {
				var element = document.getElementById('datasetInfoSpinner');
				element.classList.add("d-none");
				element.classList.remove("d-block");
				var element = document.getElementById('datasetInfo');
				element.classList.add("d-block");
				element.classList.remove("d-none");		
			});					
		}

		function filterParticipatingItems() {

			const element=document.getElementById("itemsSelection");
			if (!isElementHidden(element)) {
				if (askForSaveParticipatingItems) {
					saveParticipatingItems();
					askForSaveParticipatingItems=false;
				}
				toggleDisplay('#itemsSelection');
				return;
			}

			askForSaveParticipatingItems=true;

			//Check if user has chosen any dataset.
			var dataset =  document.getElementById("dataset");
			if(!dataset.value){
				MyModal("Info function aborted!", "No dataset has been selected!");
				return;
			}

			itemsSelectionDiv=document.getElementById("itemsSelectionDiv");
			if (isElementHidden(element)) {
				if (itemsSelectionDiv.innerHTML.includes("<!-- Rows"))	{
					retrieveParticipatingItems();
				} else {
					toggleDisplay('#itemsSelection');
				}
			}
		}

		function BatchChangeParticipatingItems(value, filterType='0', searchstr="") {
			let parentElement = document.getElementById("itemsSelectionDiv");
			let children = parentElement.children;

			for (let i = 0; i < children.length; i++) {
				if (searchstr=='') {
					children[i].children[value+1].children[0].checked=true;
				} else {
					switch (filterType) {
					case '0':
						if (children[i].children[0].innerText.startsWith(searchstr)) {
							children[i].children[value+1].children[0].checked=true;
						}
						break;
					case '1':
						if (children[i].children[0].innerText.includes(searchstr)) {
							children[i].children[value+1].children[0].checked=true;
						}
						break;
					case '2':
						if (searchstr == children[i].children[0].innerText) {
							children[i].children[value+1].children[0].checked=true;
						}
						break;
					}
				}				
			}

			document.getElementById("subStr1").value="";

		}

		function BatchActionsParticipatingItems(value) {

			str1="all the items";
			str=document.getElementById("subStr1").value;
			filterType='0';
			if (str!="") {
				filterType=document.getElementById("stringFilterType").value;
				switch (filterType) {
					case '0':
						str1 = "all the items starting with the text " + str;
						break;
					case '1':
						str1 = "all the items including the text " + str;
						break;
					case '2':
						str1 = "the items that match " + str;
						break;
				}
			}

			switch (value) {
				case -1:
					if (!confirm("Waring!!!\nAre you sure you want to reinitialize all the items?")) {
						return;
					};

					break;

					//retrieveParticipatingItems(reInitialize=true);
					//return;

				case 0:
					if (!confirm("Waring!!!\nAre you sure you want to include " + str1 + "?")) {
						return;
					};

					break;
				case 1:
					if (!confirm("Waring!!!\nAre you sure you want to declare " + str1 + " appear only on the left-hand side (LHS)?")) {
						return;
					};

					break;
				case 2:
					if (!confirm("Waring!!!\nAre you sure you want to declare " + str1 + " appear only on the right-hand side (RHS)?")) {
						return;
					};

					break;
				case 3:
					if (!confirm("Waring!!!\nAre you sure you want to exclude " + str1 + "?")) {
						return;
					};

					break;
			}

			if (value==-1) {
				BatchChangeParticipatingItems(0);
				saveParticipatingItems();
				toggleDisplay('#itemsSelection');
			} else {
				BatchChangeParticipatingItems(value, filterType, str);
			}
		}

		function datasetTypeChanged() {

			let element=null

			element=document.getElementById("itemsSelection"); 
			element.style.display = 'none';

			element=document.getElementById("itemsSelectionDiv"); 
			element.innerHTML="<!-- Rows will be inserted here by JavaScript -->"  //Initialization for use in new dataset

			const datasetType=document.getElementById("datasetType");
			datasetType.style.color='black';
			if (typeof datasetMetadata.datasetTypePredicted !== 'undefined') {
				if (datasetMetadata.datasetTypePredicted!=datasetType.value) {
					datasetType.style.color = 'orange';
				}	
			}

			switch(datasetType.value) {
			case '2':

				InitializeDatasetType2();

				element = document.getElementById('INV-2-groupItem');
				element.classList.remove("d-none");
				element.classList.add("d-block");
				element = document.getElementById('INV-2-valueItem');
				element.classList.remove("d-none");
				element.classList.add("d-block");
				element = document.getElementById('SI-3-absentValue');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('extraParametersDiv');
				element.classList.remove("col-12");
				element.classList.remove("col-10");
				element.classList.add("col-8");
				break;
			case '3':

				InitializeDatasetType3();

				element = document.getElementById('INV-2-groupItem');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('INV-2-valueItem');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('SI-3-absentValue');
				element.classList.remove("d-none");
				element.classList.add("d-block");
				element = document.getElementById('extraParametersDiv');
				element.classList.remove("col-12");
				element.classList.remove("col-8");
				element.classList.add("col-10");
				break;
			default:
				element = document.getElementById('INV-2-groupItem');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('INV-2-valueItem');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('SI-3-absentValue');
				element.classList.remove("d-block");
				element.classList.add("d-none");
				element = document.getElementById('extraParametersDiv');
				element.classList.remove("col-10");
				element.classList.remove("col-8");
				element.classList.add("col-12");
				break;			
			}
		}

    </script>
</head>

<body>

	<nav class="navbar navbar-expand-sm bg-body-tertiary" data-bs-theme="dark">
		<a id="navbar-brand" class="navbar-brand d-none d-sm-block ms-2" data-toggle="modal" onclick="credits()" data-target="#Credits" href="#">
			<img src="./images/basketwhite.svg" width="24" height="24" alt="">webApriori
        </a>		
		<ul class="navbar-nav" data-bs-theme="dark">
			<li class="nav-item">
				<a class="nav-link" href="index.html">Home</a>
			</li>
			<li class="nav-item">
				<a class="nav-link active">Rules search</a>
			</li>
		</ul>
		<ul class="navbar-nav ms-auto">
			<li id="Rate" class="nav-item">
				<a class="nav-link" href="https://docs.google.com/forms/d/e/1FAIpQLScLYL2nig3jOst4QNx-ojEawqks9j3yrVP0AHSkBTIXJAEr0w/viewform" target="_blank" rel="noopener noreferrer">Rate us!</a>
			</li>			
			<li id="SignUp" class="nav-item">
				<a class="nav-link" href="SignUp.html">Sign Up</a>
			</li>
			<li id="SignIn" class="nav-item active">
				<a class="nav-link" href="Login.html">Sign In</a>
			</li>
			<li id=sdropdown class="nav-item dropdown">
				<a class="nav-item nav-link dropdown-toggle" id="navbarDropdown" href="#" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					<img src="images/settings24.png" alt="">
				</a>
				<ul class="dropdown-menu dropdown-menu-end">
                    <li><p id="person" class="text-primary text-center"></p></li>
					<li><hr class="dropdown-divider"></li>
					<li><a id="uploadDatasetDD" class="dropdown-item" onclick="UploadDataset()" href="#"><img src="images/upload24Black.png" alt=""> Upload dataset</a></li>
					<li><a id="webApiDD" class="dropdown-item" href="webAPI.html"><img src="images/settings24black.png" alt=""> API Settings</a></li>
					<li><a id="grandPublicDatasets" class="dropdown-item" href="grandPublicDatasets.html"><img src="images/admin24black.png" alt=""> Grand public Datasets</a></li>
					<li><hr class="dropdown-divider"></li>
					<li><a id="settings"    class="dropdown-item" href="profile.html"><img src="images/settings24.png" alt="">Profile</a></li>
					<li><a id="SignOut"     class="dropdown-item" href="#"><img src="images/signout24.png" alt=""> Sign out</a></li>
				</ul>
			</li>			
		</ul>
	</nav>
	
	<br>

	<form id="uploadDatasetform" action="phpfunctions/uploadDataset.php" method="post" enctype="multipart/form-data" style="display: none">
		<div class="container lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="row">
				<div class="col-8">
					<label for="fileToUpload" class="form-label">Select dataset to upload:</label>
				</div>
				<div class="col-3">
					<label class="form-label">Public dataset:</label>

				</div>	
				<div class="col-1">
					<button type="button" class="btn btn-sm" id="hideUpload" onclick="toggleDisplay('#uploadDatasetform')" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Hides upload new dataset section"><img src="./images/close24grey.png" width="24" height="24" alt="">	</button>
				</div>
			</div>
			<div class="row">
				<div class="col-8">
					<input type="file" class="form-control" id="fileToUpload" accept=".csv, .txt" >
				</div>
				<div class="col-3">
					<label class="switch">
						<input type="checkbox" id="isPublicCheckbox" class="primary">
						<span class="slider round"></span>
					</label>
				</div>
				<div class="col-1 border border-primary rounded p-1">
					<button id="uploadDataset" class="btn btn-primary" type="submit" name="submit" style="height:100%; width:100%" id="uploadButton" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Upload the Dataset!"><img src="./images/upload32White.png" class="img-responsive" width="32" height="32" alt=""></button>
				</div>
			</div>
		</div>
	</form>		

	<div id="infoForDS" class="lightgraybackground udfwidth mx-auto border rounded p-2" style="display:none">
		<div class="container">
			<div class="row">
				<div class="col-11">
					<h2 class="text-primary">Supported dataset types</h2>
				</div>
				<div class="col-1">
					<button type="button" class="btn btn-sm" onclick="toggleDisplay('#infoForDS')" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Hides dataset type guide section"><img src="./images/close24grey.png" width="24" height="24" alt="hide">	</button>
				</div>
			</div>
		</div>

		<br>
		<p><b>1) Market Basket list (MBL).</b> No header is expected, The number of columns in each record is unspecified. 
		In extra parameters, participant columns can be declared for filtering and tuning puproses.<br> 
		<a href="javascript:toggleDisplay('#hexample1');">Examples</a></p>
		<div id="hexample1" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset.</b></div>
				<div class="card-body">
					<p class="card-text">
citrus fruit,semi-finished bread,margarine,ready soups<br>
tropical fruit,yogurt,coffee<br>
whole milk<br>
pip fruit,yogurt,cream cheese,meat spreads<br>
other vegetables,whole milk,condensed milk,long life bakery product<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset using extra parameters field to filter the items participating in association rules mining while excluding all the other items from the procedure. 
					If you are interested for the items [citrus, yogurt, cream cheese, other vegetables, whole milk, tropical fruit] then in extra parameters field you must declare: 
					<p style="color:yellow;"><i>"citrus" "yogurt" "cream cheese" "other vegetables" "whole milk" "tropical fruit"</i></p></b></div>
				<div class="card-body">
					<p class="card-text">
citrus fruit,semi-finished bread,margarine,ready soups<br>
tropical fruit,yogurt,coffee<br>
whole milk<br>
pip fruit,yogurt,cream cheese,meat spreads<br>
other vegetables,whole milk,condensed milk,long life bakery product<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>2) Order/Invoice detail (INV).</b> Header line is mandatory in that type. Number of columns is fixed in the dataset. 
		In extra parameters field it is mandatory to declare 2 parameters. The 1st parameter represents the primary key column while 2nd represents the items column.<br>
		<a href="javascript:toggleDisplay('#hexample2');">Example</a></p>
		<div id="hexample2" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset of invoice type. In extra parameters field you can declare:
					<p style="color:yellow;"><i>"InvoiceNo" "StockCode"</i></p> or <p style="color:yellow;"><i>"InvoiceNo" "Description"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
InvoiceNo;StockCode;Description;Quantity;InvoiceDate;UnitPrice;CustomerID<br>
536365;85123A;WHITE HANGING HEART T-LIGHT HOLDER;6;1/12/2010 8:26;2,55;17850<br>
536365;71053;WHITE METAL LANTERN;6;1/12/2010 8:26;3,39;17850<br>
536365;84406B;CREAM CUPID HEARTS COAT HANGER;8;1/12/2010 8:26;2,75;17850<br>
536365;84029G;KNITTED UNION FLAG HOT WATER BOTTLE;6;1/12/2010 8:26;3,39;17850<br>
536366;22633;HAND WARMER UNION JACK;6;1/12/2010 8:28;1,85;17850<br>
536366;22632;HAND WARMER RED POLKA DOT;6;1/12/2010 8:28;1,85;17850<br>
536367;84879;ASSORTED COLOUR BIRD ORNAMENT;32;1/12/2010 8:34;1,69;13047<br>
536367;22745;POPPY'S PLAYHOUSE BEDROOM ;6;1/12/2010 8:34;2,1;13047<br>
536367;22748;POPPY'S PLAYHOUSE KITCHEN;6;1/12/2010 8:34;2,1;13047<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>3) Sparse item Dataset (SI).</b> Header line is mandatory in that type of dataset and the number of columns/items is fixed. 
		Item columns are mandatory to be declared from the 2nd parameter and above in extra parameters field.
		In 1st parameter, the string of absent item must be declared!!! If absent item is nothing then assign '' or 'nan'. <br>
		<a href="javascript:toggleDisplay('#hexample3');">Examples</a></p>
		<div id="hexample3" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>1st sample. In extra parameters field you could declare:
					<p style="color:yellow;"><i>"?" "d1" "d2" "diapers" "d4" "beers" "d6" "d7" "d8" "d9" "grocery" "d11" "baby needs" "bread" "coupons" "juice"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
d1,d2,d3,d4,d5,d6,d7,d8,d9,grocery,d11,baby needs,bread,coupons,juice,...<br>
?,?,?,?,?,?,?,?,?,?,?,t,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,...<br>
?,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,t,?,?,?,t,?,?,?,?,?,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,?,?,?,?,?,?,?,?,?,t,t,t,?,t,...<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>2nd sample. In extra parameters field you could declare:
					<p style="color:yellow;"><i>"0" "air fresheners candles" "asian foods" "baby accessories" "baby bath" "body care"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
order_id,pay_method,arrival_timestamp,air fresheners candles,asian foods,baby accessories,baby bath body care,...<br>
930878,2,0:00:22,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
149444,2,0:02:45,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
327583,1,0:03:17,3,0,0,0,0,0,1,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
576050,2,0:03:33,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
200249,1,0:03:59,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,...<br>
608770,2,0:04:29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,...<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>4) Columns with multiple categorized (nominal) values (NOA).</b> Header line is optional for that kind of dataset and the number of columns is fixed. 
			If a header line exists in the dataset then participant item columns can be declared for filtering and tuning puproses optionally. 
			However keep in mind, if there is no header or columns declared in the extra parameters field, any identical values in different columns will be considered as the same value.<br>
		<a href="javascript:toggleDisplay('#hexample4');">Example</a></p>
		<div id="hexample4" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset without header. Nothing must be declared in extra parameters field.</b></div>
				<div class="card-body">
					<p class="card-text">
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,no<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset with header. In extra parameters field you could declare:					
					<p style="color:yellow;"><i>"class" "age" "survived"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
class,age,sex,survived<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,no<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
...<br></p>
				</div>
			</div>
		</div>
		<br>
		<div class="bg-warning rounded"><b>Note:</b> In extra parameters, the items must be enclosed in double quotes and be seperated with space (e.g. <b><i>"InvoiceID" "ProductID"</i></b>)</div>
		<br>
		<h2 class="text-primary">Public datasets and User Roles</h2>
		<br>
		<p>Public datasets are the ones that can freely be used by all the users that are registered to WebApriori application. For security reasons, the researchers who can upload public datasets must have advanced privileges. If so, they can choose if they will upload a private dataset - visible only to them and to their web service client - or a public one - visible to all users. The public ones are very useful for professors who need to share datasets with their students for learning or experimental purposes.</p>
		<p>If you are interested in uploading a public dataset please send an email to the WebApriori Administrator.</p>
		<p><b>stoug@ihu.gr</b></p>
		<br>
	</div>
	
	<!-- <form id="retrieveRules" action="phpfunctions/retrieveRules.php" method="post" > -->
	<form id="retrieveRules" action="phpfunctions/retrieveRulesW.php" method="post" >
		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="col">	
				<h4 class="text-center text-primary">Data preprocessing</h4>
			</div>
			<div class="row">
				<div class="col-8">	
					<label for="dataset" class="form-label">Select dataset or <a href="#" onclick="toggleDisplay('#uploadDatasetform');return false;" data-bs-toggle="tooltip" data-bs-title="Upload a new dataset on our server">upload</a> one:</label>	
				</div>
				<div class="col-1">
				</div>
				<div class="col-1">
					<button type="button" class="btn mt-n1 float-right"  onclick="toggleDisplay('#infoForDS')" id="helpForDatasetType1" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Information for the dataset type"><img src="./images/help24grey.png" width="24" height="24" alt="help">	</button>
				</div>
				<div class="col-1">
					<button type="button" id="downloadDataset" class="btn mt-n2 float-right" onclick="DoDownload('dataset')"    data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Download current dataset">
						<img src="./images/downArrow24grey.png" width="24" height="24" alt="Download Dataset">	
					</button>
				</div>
				<div class="col-1">
					<button type="button" id="deleteDataset"   class="btn mt-n1 float-right" onclick="deletecurrentDataset()" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Delete current dataset" >
						<img src="images/delete32grey.png" width="24" height="24" alt="Delete dataset">
					</button>				
				</div>
			</div>
			<div class="row">
				<div class="col-6">	
					<select id="dataset" name="dataset" class="form-control browser-default form-select" 
					        data-bs-html="true" 
							data-bs-placement="top" 
							data-bs-toggle="tooltip" 
							data-bs-delay='{"show":800,"hide":100}'
							data-bs-title="Pick a dataset for which association rules would be generated. Datasets in blue background are public" onchange="clearDatasetAttr();autoDetectDatasetAttr(false);retrieveInputParameters()">
						<option value="" disabled selected>Choose a dataset from the list</option>
					</select>
				</div>
				<div class="col-4">
					<label id="autoDetect1" class="d-block" ><a href="#" onclick="autoDetectDatasetAttr(true)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Autodetect the dataset attributes. (header, separator)">Autodetect</a> dataset attributes</label>			
					<label id="autoDetecting" class="d-none">Autodetecting attributes... Please wait</label>
				</div>
				<div class="col-2">	
					<button id="datasetInfo" type="button" class="btn btn-primary d-block" style="height:100%; width:100%" onclick="renderTable();" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Information about the dataset as well as its first rows of its up to 15 first features.">Info</button>
					<div id="datasetInfoSpinner" class="spinner-border text-warning d-none" role="status">
						<span class="visually-hidden">Loading...</span>
					</div>
				</div>			</div>

			<div id="DatasetAttrSection">
				<div class="row">
					<div class="col-3">	
						<label for="header1" class="form-label">has header?</label>		
					</div>
					<div class="col-3">
						<label for="separator" class="form-label">Separator</label>
					</div>
					<div class="col-6">
						<label for="datasetType" class="form-label">Dataset type</label>
					</div>
				</div>
				<div class="row">
					<div class="col-3">	
						<label class="switch">
							<input type="checkbox" id="header1" class="primary">
							<span class="slider round"></span>
						</label>
					</div>
					<div class="col-3">	
						<input type="text" id="separator" name="separator" class="primary form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The separator of the items in the CSV file. The most common characters used as delimiters are ';', ',' '{TAB}' '{SPACE}' and (:). Keep in mind that especially the {TAB} character is presended by {TAB} or \t string." value=";" placeholder=";">		
					</div>
					<div class="col-6">
						<select id="datasetType" class="browser-default form-select form-control" onchange="datasetTypeChanged()" data-bs-html="true" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' 
							data-bs-title="<p>1) Market Basket list<br>2) Order/Invoice detail<br>3) Sparse item Dataset<br>4) Columns with multiple nomimal values</p><p>For more details click the <img src='./images/help24grey.png' width='24' height='24' alt='help'> icon.">
							<option value="0" selected>unmanaged dataset type</option>
							<option value="1">1 - Market basket list</option>
							<option value="2">2 - Order/Invoice detail</option>
							<option value="3">3 - Sparse item dataset</option>
							<option value="4">4 - Multiple nomimal values</option>
						</select>
					</div>
				</div>	


				<div class="row">
					<div id="INV-2-groupItem" class="col-6" style="display:none">
						<label for="groupItem" class="form-label">Group item</label>
						<select id="groupItem" class="browser-default form-select form-control" data-bs-html="false" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' 
							data-bs-title="Please choose the grouping column.">
						</select>
					</div>
					<div id="INV-2-valueItem" class="col-6" style="display:none">
						<label for="valueItem" class="form-label">Value item</label>
						<select id="valueItem" class="browser-default form-select form-control" data-bs-html="false" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' 
							data-bs-title="Please choose the column that includes the items participating in mining.">
						</select>
					</div>
					<div id="SI-3-absentValue" class="col-6" style="display:none">
						<label for="absentValue" class="form-label">Absent item</label>
						<input type="text" id="absentValue" name="absentValue" class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Declare the absent value without quotes, for 3 - Sparse Item (SI) dataset type, if not already predicted successfully. If it is the empty value declare (nan). For more details please press ?" placeholder="absent Item e.g. 0">
					</div>
					<div id="extraParametersDiv" class="col-12">
						<label id="filterParticipatingItems1" class="d-block" ><a href="#" onclick="filterParticipatingItems()" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Filter the items that would participate in AR mining. ">Filter participating items</a></label>			
					</div>
				</div>
			</div>
		</div>

		<div id="datasetDescribe" class="lightgraybackground udfwidth mx-auto border rounded p-2" style="display:none">
			<div class="container mt-2">
				<div class="row">
					<div class="col-11">
						<h4 class="text-center text-primary">Dataset information</h4>
					</div>
					<div class="col-1">
						<button type="button" class="btn btn-sm" onclick="toggleDisplay('#datasetDescribe')" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Hides dataset type guide section"><img src="./images/close24grey.png" width="24" height="24" alt="hide">	</button>
					</div>
				</div>

				<div class="container text-center">
					<div id="datasetFeaturesDiv" class="row row-cols-1 row-cols-sm-2 row-cols-md-3">
							<!-- Rows will be inserted here by JavaScript -->
					</div>
				</div>
				
				<h5 id="H5Test" class="text-center text-primary mt-4">Dataset's first <input type="text" id="NRows" class="form-control d-inline" style="width: 50px;" value="10" placeholder="10"> rows & <input type="text" id="NCols" class="form-control d-inline" style="width: 50px;" value="15" placeholder="15"> features <button type="button" class="btn mt-n1 float-right"  onclick="changeRowsAndCols();" id="refreshHeadTable" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Refresh the Dataset's head information table"><img src="./images/bootstrap/repeat.svg" width="24" height="24" alt="refresh"></button></h5> 

				<div class="table-responsive">
					<table class="table table-bordered table-striped mt-2">
						<thead class="thead-dark" id="dD1TableHeader">
							<!-- Rows will be inserted here by JavaScript -->
						</thead>
						<tbody id="data-table-body">
							<!-- Rows will be inserted here by JavaScript -->
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div id="itemsSelection"  style="display:none">

			<br>

			<div class="container mt-2 lightgraybackground udfwidth mx-auto border rounded p-2">

				<div class="row">
					<div class="col-11">
						<h4 class="text-center text-primary">Items participating in AR mining process</h4>
					</div>
					<div class="col-1">
						<button type="button" class="btn btn-sm" onclick="filterParticipatingItems()" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Hides dataset type guide section"><img src="./images/close24grey.png" width="24" height="24" alt="hide">	</button>
					</div>
				</div>

				<div class="row">
					<div class="col-2">
						<p class="text-center text-primary">Batch Actions</p>
					</div>
					<div class="col-2">
						<button type="button" class="btn btn-sm btn-secondary m-0 p-0 w-100" onclick="BatchActionsParticipatingItems(-1)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Reinitializes all items in the dataset and marks them as included.">Reinitialize</button>
					</div>
					<div class="col-2">
						<button type="button" class="btn btn-sm btn-secondary m-0 p-0 w-100" onclick="BatchActionsParticipatingItems(0)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="This action includes all items in AR mining.">All included</button>
					</div>
					<div class="col-2">
						<button type="button" class="btn btn-sm btn-secondary m-0 p-0 w-100" onclick="BatchActionsParticipatingItems(1)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Specifies that all items are restricted to only appear on the left-hand side (LHS) in association rule mining.">All in LHS</button>
					</div>
					<div class="col-2">
						<button type="button" class="btn btn-sm btn-secondary m-0 p-0 w-100" onclick="BatchActionsParticipatingItems(2)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Specifies that all items are restricted to only appear on the right-hand side (RHS) in association rule mining.">All in RHS</button>
					</div>
					<div class="col-2">
						<button type="button" class="btn btn-sm btn-secondary m-0 p-0 w-100" onclick="BatchActionsParticipatingItems(3)" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="This action excludes all items in AR mining.">All excluded</button>
					</div>
				</div>

				<div class="row">
					<div class="col-4">
						<p class="text-center text-primary">Apply the function above to items that </p>
					</div>	
					<div class="col-4">
						<select id="stringFilterType" class="form-select form-select-sm">
							<option value="0" selected>Start with</option>
							<option value="1">contains</option>
							<option value="2">match exactly</option>
						</select>
					</div>
					<div class="col-4">
						<input type="text" id="subStr1" class="form-control form-control-sm" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The separator of the items in the CSV file. The most common characters used as delimiters are ';', ',' '{TAB}' '{SPACE}' and (:). Keep in mind that especially the {TAB} character is presended by {TAB} or \t string." value="" placeholder="text segment">		
					</div>
				</div>


				<div class="container ">
					<div id="itemsSelectionDiv" class="row row-cols-sm-3 row-cols-md-4 row-cols-xl-5">
						<!-- Rows will be inserted here by JavaScript -->
					</div>
				</div>
				
			</div>
		</div>

		<br>

		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="col">	
				<h4 class="text-center text-primary">ARM parameterization</h4>
			</div>
			<div class="row">
				<div class="col-6">		
					<label for="min_support">Minimum support</label>
				</div>
				<div class="col-6">
					<label for="min_confidence">Minimum confidence</label>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="min_support" name="min_support" class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The minimum support that each association rule should have" value="0.01" placeholder="0.01">
				</div>
				<div class="col-6">	
					<input type="text" id="min_confidence" name="min_confidence" class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The minimum confidence that each association rule should have" value="0.2" placeholder="0.2">
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<label for="min_lift">Minimum lift</label>
				</div>
				<div class="col-6">
					<label for="max_length">Maximum rules items</label>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="min_lift" name="min_lift" class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The minimum lift that each association rule should have" value="1.5" placeholder="1.5">
				</div>
				<div class="col-6">	
					<input type="text" id="max_length" name="max_length" class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The maximum items each association rule consist of" value="4" placeholder="4">
				</div>
			</div>	
			<br>
			<div class="col">	
				<h4 class="text-center text-primary" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="In this section you can remove redundant association rules optionally. Please hover over the switches to get information for each case.">Redundant association rule elimination</h4>
			</div>
			<div class="row">
				<div class="col-4 mt-1" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="The comparable rules are the ones that have reversed their LHS and RHS (e.g. A->B & B->A). The rule with the smaller confidence value is removed.">
					<label for="Redundant1">Interchange LHS and RHS case</label>
					<!-- For centering the slider -->
					<div class="mx-auto p-2" style="width: 70px;">
						<label class="switch" for="Redundant1">
							<input type="checkbox" id="Redundant1" class="primary form-check-input mt-0">
							<span class="slider round"></span>
						</label>
					</div>
				</div>
				<div class="col-4 mt-1" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Removes redundant rules that have multiple items in LHS but have the same RHS itemset. If n number of (n-1) LHS-itemset with the same RHS rules are found in the retrieved rule set, the rule is removed otherwise remains. Example: If XY->Z, X->Z, Y->Z exist in the rule set then XY->Z is removed">
					<label for="Redundant2">Redundant Rules with Fixed RHS</label>
					<!-- For centering the slider -->
					<div class="mx-auto p-2" style="width: 70px;">
						<label class="switch" >
							<input type="checkbox" id="Redundant2" class="primary" >
							<span class="slider round"></span>
						</label>
					</div>
				</div>
				<div class="col-4 mt-1" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Removes redundant rules that have multiple items in RHS but have the same LHS itemset. If n number of (n-1) RHS-itemset with the same LHS rules are found in the retrieved rule set, the rule is removed otherwise remains. Example: If X->YZ, X->Y, X->Z exist in the rule set then X->YZ is removed">
					<label for="Redundant3">Redundant Rules with Fixed LHS</label>
					<!-- For centering the slider -->
					<div class="mx-auto p-2" style="width: 70px;">
						<label class="switch">
							<input type="checkbox" id="Redundant3" class="primary">
							<span class="slider round"></span>
						</label>
					</div>
				</div>
			</div>	
			<div class="p-1 mt-2 mx-auto border border-primary rounded" style="width:220px">
				<button id="submitBtn" type="submit" class="btn btn-primary btn-inline" style="height:100%; width:100%">Retrieve association rules</button>
			</div>
		</div>	
	</form>

	<br>

	<div id="infoForResults" class="lightgraybackground udfwidth mx-auto border rounded p-2" style="display:none">
		<div class="container">
			<div class="row">
				<div class="col-11">
					<h4 class="text-primary">Information about results and metrics</h4>
				</div>
				<div class="col-1">
					<button type="button" class="btn btn-sm" onclick="toggleDisplay('#infoForResults')" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Hides dataset type guide section"><img src="./images/close24grey.png" width="24" height="24" alt="hide">	</button>
				</div>
			</div>
		</div>

		<br>
		<ul>
			<li>
				<p><b>Association rule (AR) - LHS - RHS</b>
				</p>
				<p>An <b>association rule (AR)</b> involves a <b>LHS</b> (Left-Hand Side or antecedent or body) itemset and a <b>RHS</b> (Right-Hand Side or consequent or head) itemset. The rule itemset is the union of all items present in the rule's body and head. An association rule can be represented as:
					\[ \left\{ x, y \right\} \to \left\{ a, b \right\} \]
					where \( \left\{ x, y \right\} \) is the <b>LHS</b>, \( \left\{ a, b \right\} \) is the <b>RHS</b>, and \( \left\{ x, y, a, b \right\} \) is the <b>rule's itemset</b>.
				</p>
			</li>
			<li>
				<p><b>Support (Sup)</b> is the frequency of occurrence of the rule itemset in the given set of transactions. Its value lies in the range [0, 1]. An itemset is considered frequent if its support value is greater than or equal to a minimum support threshold set by the user. For instance, if the threshold is set to 0.1, an itemset is frequent if all its items appear together in at least 10% of all transactions in the given dataset. Support is estimated as follows:
					\[Support(\{A\}\rightarrow \{B\})= \frac{transactions\ containing\ both\ A\ \&\ B}{Total\ number\ of\ transactions}\]
				</p>
			</li>
			<li>
				<p><b>Confidence</b> is the conditional probability of the occurrence of the head itemset given that the body itemset is already present in a typical transaction. Its value also lies in the range [0, 1].
				\[Confidence(\{A\}\rightarrow \{B\})= \frac{transactions\ containing\ both\ A\ \&\ B}{transactions\ containing\ A}\]
				The closer support and confidence lie to 1, the stronger is the rule. However, a strong association rule may not necessarily be interesting. For instance, both the confidence and support of the rule \( \{A\} \rightarrow \{B\} \) may equal 1, yet there may be no causality implying that \( A \) infers \( B \). This issue is addressed by the <b>Lift</b> measure.</li>
				</p>
			</li>
			<li>
				<b>Lift</b>  is a metric used in association rule mining to measure the strength of an association rule. It helps to determine whether the occurrence of one itemset is truly dependent on the occurrence of another itemset, beyond what would be expected by chance. Lift is defined as:
				\[Lift(\{A\}\rightarrow \{B\})= \frac{Confidence(\{A\}\rightarrow \{B\})}{Support(\{B\})}\]
				<p>If Lift = 1 then the occurrence of A and B together is exactly what would be expected if A and B were independent.</p>
				<p>If Lift > 1 then there is a positive correlation between	A and B; they occur together more often than expected if they were independent.</p>
				<p>If Lift < 1 then there is a negative correlation between A and B; they occur together less often than expected if they were independent.</p>
				<p>Lift provides more insight than just support and confidence by taking into account the actual occurrence of both itemsets compared to their expected occurrence under independence. This makes it a valuable metric for identifying truly interesting and useful association rules.</p>
				<p>The greater the lift is, the more useful the AR is. The symmetric property applies for lift: \( \{A\} \rightarrow \{B\} \) lift value is equal to \( \{B\} \rightarrow \{A\} \) value.</p>
			</li>
			<li>
				<p><b>Conviction</b> is another interesting metric that also measures the independence of A and B, but goes a little bit further. Contrarily to lift, conviction is sensitive in the logical definition of implication and attempts to measure the degree of rule direction. In that manner,</p>
				\[Conviction(\{A\}\rightarrow \{B\}) \not\equiv Conviction(\{B\}\rightarrow \{A\}) \]
				<p>Conviction is defined as:</p>
				\[Conviction(\{A\}\rightarrow \{B\})= \frac{1 - Support(\{B\})}{1 - Confidence(\{A\}\rightarrow \{B\})}\]
			</li>
			<li>
				<p><b>Leverage</b>, like the <b>Lift</b>, measures the relation between the probability of a given association rule to occur and its expected probability if the items were independent of each other. The only difference between the two measures is that leverage calculates the difference of the probabilities while the lift calculates their ratio. Therefore, while the lift tends to rank higher strong associations involving less frequent itemsets, the leverage prioritizes first itemsets involving higher support values. As in the case with the lift, the symmetric property applies to the leverage: </p>
				\[ \textit {leverage}(\{A\} \rightarrow \{B\}) = \textit {leverage}(\{B\} \rightarrow \{A\}) \]
				<p>Leverage is defined as:</p>
				\[leverage(\{A\} \rightarrow \{B\}) = support(\{A\} \rightarrow \{B\}) - support(\{A\}) \times support(\{B\})\]
			</li>
		</ul>


	</div>

	<br>

	<div id="showResults" class="table-responsive dataTables_wrapper dt-bootstrap4 " style="display: none">

		<div class="container lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="row">
				<div class="col-6">		
					<label for="Records">Records count</label>
				</div>
				<div class="col-4">
					<label for="RecordsCreationTime">Dataset read Time</label>
				</div>
				<div class="col-1">
					<button type="button" class="btn mt-n1 float-right" onclick="toggleDisplay('#infoForResults')" id="infoForResults" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Information for the results and the metrics used"><img src="./images/help24grey.png" width="24" height="24" alt="help">	</button>
				</div>
				<div class="col-1">
					<button type="button" class="btn mt-n2 float-right" onclick="DoDownload()" id="DownloadJson" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Download association rules in a json format file"><img src="./images/downArrow24grey.png" width="24" height="24" alt="">	</button>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="Records" readonly class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Dataset records count">
				</div>
				<div class="col-6">	
					<input type="text" id="RecordsCreationTime" readonly class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Time spend (in seconds) for retrieving dataset records">
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<label for="RulesCount">Association rules retrieved</label>
				</div>
				<div class="col-6">
					<label for="RulesCreationTime">Rules retrieval time</label>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="RulesCount" readonly class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Retrieved association rules count">
				</div>
				<div class="col-6">	
					<input type="text" id="RulesCreationTime" readonly class="form-control" data-bs-toggle="tooltip" data-bs-delay='{"show":800,"hide":100}' data-bs-title="Time spend for retrieving the association rules">
				</div>
			</div>	
		</div>	

		<table id="showResultsTbl" class="table table-striped table-bordered table-hover table-sm" style="width:100%">
			<thead class="thead-dark">
			</thead>
		</table>
	</div>
	
	<br>
	<br>
	<br>
	
	<footer>
        <nav id="c-footer" class="navbar fixed-bottom navbar-expand-lg bg-body-tertiary" data-bs-theme="dark">
            <span id="c-footer-span" class="text-muted ms-2" ></span>
        </nav>
	</footer> 

</body>
</html>
