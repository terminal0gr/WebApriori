<!DOCTYPE html>
<html>
<head>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-130197414-2"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-130197414-2');
    </script>

	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	<!-- <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"/> -->
	<link rel="stylesheet" type="text/css" href="DataTables/DataTables-1.10.20/css/jquery.dataTables.min.css"/>

	<link rel="stylesheet" href="css/styles.css" type="text/css" />
	<link rel="stylesheet" href="css/switch.css" type="text/css" />

	<script src="scripts/jquery-3.4.1.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

	<!-- <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script> -->
	<script type="text/javascript" src="DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
	<!-- <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap.min.js"></script> -->

	<script src="scripts/scripts.js"></script>

    <link rel="icon" type="image/png" href="images/basketwhite.png"/>

    <title>WebApriori Association rules mining</title>

	<script>

		var resultsTable;
		var ajaxReq;
		var tmpHtml;

		$(function() {

			// initialization of tooltips in page
			$('[data-toggle="tooltip"]').tooltip()

			if (!sessionStorage.getItem('token') || sessionStorage.getItem('token')==0) {
				MyModal("WebApriori",'Please Sign in, or Sign up if you are a new user, in order to use our new association rules mining engine!');
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
			}

			if (sessionStorage.getItem('version')) {
				$('#navbar-brand').html('<img class="d-inline-block mr-1" src="./images/basketwhite.svg" width="24" height="24" alt="">WebApriori ' +  sessionStorage.getItem('version'));
			}
			else {
				sessionStorage.clear();
				window.location.href='index.html';
			}
			M_F();
			VT();

            if (sessionStorage.getItem('administrator') && sessionStorage.getItem('administrator')==1) {
                $('#grandPublicDatasets').show();
            }else{
                $('#grandPublicDatasets').hide();
            }

			if (sessionStorage.getItem('grandPublicDatasets') && sessionStorage.getItem('grandPublicDatasets')==1) {
				$('#publicDataset').show();
            }else{
                $('#publicDataset').hide();
            }

			GetDatasetFilelist();	

			$('#SignOut').click(function() {
				sessionStorage.clear();
				window.location.href='index.html';
			});		

			$('#uploadDatasetform').submit(function(e) {
				// Stop the browser from submitting the form.
				e.preventDefault();

				//Prepare the data to send
				var formData = new FormData();
				var fileSelect = document.getElementById("fileToUpload");
				if(fileSelect.files && fileSelect.files.length == 1){
                    var file = fileSelect.files[0]
					formData.set("fileToUpload", file , file.name);
				}
				else {
					MyModal("Information", "You have not chosen a file for upload.<br>Please choose one.");
					return;
				}
				var datasetType = document.getElementById("datasetType");
				if(!datasetType.value){
					MyModal("Information", "You have not chosen datasetType!!!");
					return;
				}
				formData.set("datasetType", datasetType.value);
				if (sessionStorage.getItem('token')) {
					formData.set("token",sessionStorage.getItem('token'));
				}
				else {
					MyModal("Error", "You are not signed in!!! Please sign in/up");
					return;
				}
				
				formData.set("isPublic", $("#isPublicCheckbox").is(":checked"));

				// Submit the form using AJAX.
				ajaxReq = $.ajax({
					type: 'POST',
					url: $('#uploadDatasetform').attr('action'),
					contentType: false,
                    cache: false,
                    processData:false,
					data: formData,
					beforeSend: function( xhr ) {
						tmpHtml=$('#uploadDataset').html();
						$('#uploadDataset').removeClass( "btn-primary" ).addClass("btn-warning").html('<div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>');	
  					}
				}).done(function(response, textStatus, jqXHR) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						if (jqXHR.status==200) {
							MyModal(res.title,res.message);
							GetDatasetFilelist();
						} else {
							MyModal(res.title, res.message);
						}
					}
					else alert(response);
				}).fail(function( jqXHR, textStatus, thrownError ) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					} 
					else MyModal("Error", jqXHR.responseText);
				}).always(function() {
					$('#uploadDataset').removeClass("btn-warning").addClass("btn-primary").html(tmpHtml);
				});
			});

			// Set up an event listener for the form.
			$('#retrieveRules').submit(function(e) {
				// Stop the browser from submitting the form.
				e.preventDefault();

				if ($('#submitBtn').hasClass("btn-warning")) {
					ajaxReq.abort();
					ajaxreq=undefined;
					MyModal("Exclamation","Function aborted by user.");
					return;
				};

				//Prepare the data to send
				var datasetType = document.getElementById("dataset");
				if(!datasetType.value){
					MyModal("Information", "Please choose a dataset!!!");
					return;
				}

                // Serialize the form data first in array form so to add more elements.
				var formData = $('#retrieveRules').serializeArray(); // convert form to array

				if (sessionStorage.getItem('token')) {
					formData.push({name: "token", value: sessionStorage.getItem('token')});
				}
				else {
					MyModal("Error", "You are not signed in!!! Please sign in/up");
					return;
				}

				// Submit the form using AJAX.
				ajaxReq= $.ajax({
					type: 'POST',
					url: $('#retrieveRules').attr('action'),
					data: $.param(formData), //serialize 	the array
					beforeSend: function( xhr ) {
						$('#showResults').hide("slow");
						//$( "p" ).removeClass( "myClass noClass" ).addClass( "yourClass" );
						$('#submitBtn').html("<b>Retrieving rules. Click to abort</b>").removeClass( "btn-primary" ).addClass("btn-warning");	
  					}
				})
				.done(function(response, textStatus, jqXHR) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						if (jqXHR.status!=200) {
							MyModal(res.title, res.message);
						} else {					
							try {
								if (isJSON(res.message)) { 
									resm=JSON.parse(res.message);
									fillTable(resm);
								} else {
									if (res.message) {
										MyModal("Error 10" , res.message);
									} else {
										return;
									}
								}
							} catch(err){
								MyModal("Error 20<br>" + err.message, res.message);
								return;
							}
						} 
					}
					else alert(response);
				})
				.fail(function(jqXHR) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						if (res.title || res.message) {
							MyModal(res.title, res.message);
						}
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					} 
					if (jqXHR.responseText) {
						MyModal("Error 30", jqXHR.responseText);						
					} else {
						return;
					}
				})
				.always(function() {
					$('#submitBtn').html("Retrieve association rules").removeClass("btn-warning").addClass("btn-primary");
				});
			});

			$('#extra_parameters').blur(function() {
				var regex = /[\[\]]/g;
				var extraparams=this.value.replace(regex,''); 
				var regex = /,/g;
				extraparams=extraparams.replace(regex,' '); 
				var regex = /'/g;
				extraparams=extraparams.replace(regex,'"'); 
				this.value=extraparams;
			}); 

		});

        function fillTable(jsonData) {

			$('#Records').val(jsonData.Records)
			$('#RecordsCreationTime').val(jsonData.RecordsCreationTime + ' seconds')
			$('#RulesCount').val(jsonData.RulesCount)
			$('#RulesCreationTime').val(jsonData.RulesCreationTime + ' seconds')			

			if (resultsTable) {
				resultsTable.clear().rows.add(jsonData.rules).draw();
			} else {
				resultsTable = $('#showResultsTbl').DataTable( {
					stateSave: true,
					data: jsonData.rules,
					columns: [
						{ "title" : "#",
							"data"  : function ( row, type, val, meta ) {
							return meta.row+1;
							}},
						{ "title" : "LHS/Body",
							"data"  : "LHS",
							"render": "[, ]" },
						{ "title" : "LHS Count/Sup",
							"data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.LHS_Count + ' / ' + row.LHS_Support.toFixed(3);
								}
								else {
									return row.LHS_Count
								};
							} },
						{ "title" : "RHS/Head",
							"data"  : "RHS",
							"render": "[, ]" },
						{ "title" : "RHS Count/Sup",
							"data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.RHS_Count + ' / ' + row.RHS_Support.toFixed(3);
								}
								else {
									return row.RHS_Count
								};
							} },
						{ "title" : "Rule Count/Sup",
						  "data"  : function ( row, type, val, meta ) {
								if (type === 'display') {
									return row.Count + ' / ' + row.Support.toFixed(3);
								}
								else {
									return row.Count
								};
							} },									 
						{ "title" : "Confidence",
							"data"  : "Confidence",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },
						{ "title" : "Lift",
							"data"  : "Lift",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },										
						{ "title" : "Conviction",
							"data"  : "Conviction",
							"render": function ( data, type, row, meta ) {
							if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} },
						{ "title" : "Leverage",
							"data"  : "Leverage",
							"render": function ( data, type, row, meta ) {
								if (type === 'display') {
									return data.toFixed(3);
								} else {
									return data
								}
							} 
						},
					]
				} );
			};
			$("#showResults").show("slow");
		};

		function GetDatasetFilelist() {
			var formData = new FormData();
			if (sessionStorage.getItem('token')) {
				formData.set("token",sessionStorage.getItem('token'));
			}
			else {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				return;
			}

			$.ajax({
				type: 'POST' ,
				url: 'phpfunctions/retrieveDatasetFilelist.php',
				contentType: false,
                cache: false,
                processData:false ,
			    data: formData
			}) 	
			.done(function(response) {
				if (isJSON(response)) {
					res=JSON.parse(response);
					try {
						str='<option value="" disabled selected >Choose a dataset or dblclick to upload a new</option>';
						res.forEach(function(data, index){
							if (data.public===0) {
								str += '<option value="' + data.datasetType + data.filename + '">(' + data.datasetType + ') ' + data.filename + '</option>' 
							}else{
								str += '<option value="' + 'p|' + data.datasetType + data.filename + '" style="background-color: powderblue;">(public ' + data.datasetType + ') ' + data.filename + '</option>' 
							}	  
						});
						$("#dataset").html(str);
					}
					catch(err) {
						MyModal("Error", err.message);
					}
				}
				else {
					if (response) {
						MyModal("Error", response);
					}
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400 && sessionStorage.getItem('token')) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("association rules",'Unknown error occured!');
				}
			});
		};

        // It handles the footer when the size of the window changes.
        function M_F() {
			if ($(window).width() <= 600) {
				$('.udfwidth').css("width", "98%");
			}
			else if ($(window).width() > 600 && $(window).width() <= 1500) {
				var pos1=Math.round(Math.abs($(window).width()-1500)*0.055+50);
				$('.udfwidth').css("width", pos1 + "%");
			}
			else {	
				$('.udfwidth').css("width", "50%");
			}
			style="width: 329px;"
            if ($(window).width() <= 800 || $(window).height() <= 600) {
                $('#c-footer').removeClass('fixed-bottom');
            }
            else {
                $('#c-footer').addClass('fixed-bottom')
            }
        };

        // handle the interface when guest or logged in
        function VT() {
            if (sessionStorage.getItem('token') && sessionStorage.getItem('token')!='0') {
                $('#SignUp').hide();
				$('#SignIn').hide();
                if (sessionStorage.getItem('username')) {
                    $('#person').html('<img src="images/person24.png" alt="p">' + sessionStorage.getItem('username'));
                    $('#person').show;
                } else {
                    $('#person').hide;
                }                    
                $('#sdropdown').show();
            } else {
                $('#SignUp').show();
                $('#SignIn').show();
                $('#sdropdown').hide();
			}
			
			if (sessionStorage.getItem('administrator') && sessionStorage.getItem('administrator')==1) {
                $('#grandPublicDatasets').show();
            }else{
                $('#grandPublicDatasets').hide();
            }
        };

        $( window ).resize(function() {
            M_F();
        });		
		
		function UploadDataset() {
			if ($('#uploadDatasetform').is(":visible")) {
				$('#uploadDatasetform').hide( "slow" );
			}
			else {
				$('#uploadDatasetform').show( "slow" );
			}
		};

		function deletecurrentDataset() {
			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			var x = document.getElementById("dataset");
			if (!x.value) {
				MyModal("Information","No dataset to delete.");
				return;
			}
			pbl=x.value.substr(0,2);	
			if (pbl=="p|") {
				pbl="public dataset " + x.value.substr(3);
			}else{
				pbl="dataset " + x.value.substr(1);
			}
			if (confirm("Are you sure you want to delete " + pbl + ";")){
				var formData = new FormData();
				formData.set("token",sessionStorage.getItem('token'));
				formData.set("dataset",x.value);
				$.ajax({
					type: 'POST' ,
					url: 'phpfunctions/deleteDataset.php',
					data: formData,
					contentType: false,
                	cache: false,
                	processData:false
				}) 	
				.done(function(response) {
					if (isJSON(response)) {
						res=JSON.parse(response);
						try {
							GetDatasetFilelist();
						}
						catch(err) {
							MyModal("Error", err.message);
						}
					}
					else {
						MyModal("Error", response);
					}
				}).fail(function( jqXHR, textStatus, thrownError ) {
					if (jqXHR.responseText) {
						if (isJSON(jqXHR.responseText)) {
							res=JSON.parse(jqXHR.responseText);
							MyModal(res.title, res.message);
							if ( jqXHR.status>=400) {
								setTimeout(function() {
									sessionStorage.clear();
									window.location.href='index.html';
								}, 3000);	
							}
						}
						else alert(jqXHR.responseText);
					} else {
						MyModal("WebApriori",'Unknown error occured!');
					}
				});
			}
		};

		function retrieveInputParameters() {
			if (!sessionStorage.getItem('token')) {
				MyModal("Error", "You are not signed in!!! Please sign in/up");
				setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
				return;
			}

			var x = document.getElementById("dataset");
			if (!x.value) {
				return;
			}

			var formData = new FormData();
			formData.set("token",sessionStorage.getItem('token'));
			formData.set("dataset",x.value);
			$.ajax({
				type: 'POST' ,
				url: 'phpfunctions/retrieveInputParameters.php',
				data: formData,
				contentType: false,
				cache: false,
				processData:false
			}) 	
			.done(function(response, textStatus, jqXHR) {
				//cover both null and undefined circumstanses and if it is a JSON obj
				if (response!=undefined && response!=null && isJSON(response)) {
					res=JSON.parse(response);
					try {
						if (jqXHR.status!=200) {
							// not found input parameters
							document.getElementById('separator').value=""; 
							document.getElementById('min_support').value=""; 
							document.getElementById('min_confidence').value=""; 
							document.getElementById('min_lift').value=""; 
							document.getElementById('max_length').value=""; 
							document.getElementById('extra_parameters').value=""; 
                            $("#showResults").hide();
						} else {
							document.getElementById('separator').value=res.datasetSep; 
							document.getElementById('min_support').value=res.min_support; 
							document.getElementById('min_confidence').value=res.min_confidence; 
							document.getElementById('min_lift').value=res.min_lift; 
							document.getElementById('max_length').value=res.max_length; 

							//loads res.datasetArgs as a python list like =>['a', 'b'].
							//but we need the format =>"a" "b" so, we apply the above regex!
							var regex = /[\[\],]/g;
							var extraparams=res.datasetArgs.replace(regex,'');
							var regex = /,/g;
							extraparams=extraparams.replace(regex,' ');  
							var regex = /'/g;
							extraparams=extraparams.replace(regex,'"'); 
							document.getElementById('extra_parameters').value=extraparams; 

							fillTable(res);
						}
					}
					catch(err) {
						MyModal("Error", err.message);
					}
				}
				else {
					//cover both null and undefined circumstanses
					if (response!=undefined && response!=null) {
						MyModal("Error", response);
					} else {
						MyModal("Error", "Unknown error occured");
					}
				}
			}).fail(function( jqXHR, textStatus, thrownError ) {
				if (jqXHR.responseText) {
					if (isJSON(jqXHR.responseText)) {
						res=JSON.parse(jqXHR.responseText);
						MyModal(res.title, res.message);
						if (jqXHR.status>=400) {
							setTimeout(function() {
								sessionStorage.clear();
								window.location.href='index.html';
							}, 3000);	
						}
					}
					else alert(jqXHR.responseText);
				} else {
					MyModal("association rules",'Unknown error occured!');
				}
			});
		};

		function DoDownload(kind="result") {
			var str='phpfunctions/download.php?'
			const data = { 'token': sessionStorage.getItem('token'), 
			               'dataset': document.getElementById("dataset").value,
						   'kind': kind };
			const ret = [];
   			for (let d in data)
     			ret.push(encodeURIComponent(d) + '=' + encodeURIComponent(data[d]));
   			str+=ret.join('&');

			window.location=str;
		};

    </script>
</head>

<body>

	<nav class="navbar navbar-expand-sm navbar-dark bg-dark">
		<a id="navbar-brand" class="navbar-brand d-none d-sm-block" data-toggle="modal" onclick="credits()" data-target="#Credits" href="#">
			<img class="d-inline-block mr-1" src="./images/basketwhite.svg" width="24" height="24" alt="">WebApriori
        </a>		
		<ul class="navbar-nav mr-auto">
			<li class="nav-item">
				<a class="nav-link" href="index.html">Home</a>
			</li>
			<li class="nav-item">
				<a class="nav-link active">Rules search</a>
			</li>
		</ul>
		<ul class="navbar-nav ml-auto">
			<li id="Rate" class="nav-item">
				<a class="nav-link" href="https://docs.google.com/forms/d/e/1FAIpQLScLYL2nig3jOst4QNx-ojEawqks9j3yrVP0AHSkBTIXJAEr0w/viewform" target="_blank">Rate us!</a>
			</li>			
			<li id="SignUp" class="nav-item">
				<a class="nav-link" href="SignUp.html">Sign Up</a>
			</li>
			<li id="SignIn" class="nav-item active">
				<a class="nav-link" href="Login.html">Sign In</a>
			</li>
			<li id=sdropdown class="nav-item dropdown">
				<a class="nav-item nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
					<img src="images/settings24.png" alt="">
				</a>
				<div class="dropdown-menu dropdown-menu-right dropdown-menu-dark" aria-labelledby="navbarDropdown">
                    <p id="person" class="text-primary text-center"></p>
					<div class="dropdown-divider"></div>
					<a id="uploadDatasetDD" class="dropdown-item" onclick="UploadDataset()" href="#"><img src="images/upload24Black.png" alt=""> Upload dataset</a>
					<a id="webApiDD" class="dropdown-item" href="webAPI.html"><img src="images/settings24black.png" alt=""> API Settings</a>
					<a id="grandPublicDatasets" class="dropdown-item" href="grandPublicDatasets.html"><img src="images/admin24black.png" alt=""> Grand public Datasets</a>
					<div class="dropdown-divider"></div>
					<a id="settings"    class="dropdown-item" href="profile.html"><img src="images/settings24.png" alt="">Profile</a>
					<a id="SignOut"     class="dropdown-item" href="#"><img src="images/signout24.png" alt=""> Sign out</a>
				</div>
			</li>			
		</ul>
	</nav>
	
	<br>

	<form id="uploadDatasetform" action="phpfunctions/uploadDataset.php" method="post" enctype="multipart/form-data" style="display: none">
		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="form-row">
				<div class="col-11">
					<div class="form-row">
						<div class="col-5">
							<label class="float-right">Select dataset to upload:</label>
						</div>
						<div class="col-7">
							<input type="file" class="form-control-file" name="fileToUpload" id="fileToUpload" accept=".csv, .txt" >
						</div>						
					</div>
					<div class="form-row">
						<div class="col-1">
							<button type="button" class="btn btn-sm" id="hideUpload" onclick="toggleDisplay('#uploadDatasetform')" data-trigger="hover" data-toggle="tooltip" title="Hides upload new dataset section"><img src="./images/close24grey.png" width="24" height="24" alt="">	</button>
						</div>
						<div class="col-1">
							<!-- <button type="button" class="btn btn-sm" data-toggle="collapse" data-target="#collapseInfo" aria-expanded="false" aria-controls="collapseInfo" id="helpForDatasetType" data-trigger="hover" data-toggle="tooltip" title="Information for the dataset type"><img src="./images/help24grey.png" width="24" height="24" alt="">	</button> -->
							<button type="button" class="btn btn-sm" onclick="toggleDisplay('#infoForDS')" id="helpForDatasetType" data-trigger="hover" data-toggle="tooltip" title="Information for the dataset type"><img src="./images/help24grey.png" width="24" height="24" alt="">	</button>
						</div>
						<div class="col-3">
							<label class="col-form-label float-right">dataset type:</label>
						</div>
						<div class="col-7">
							<select id="datasetType" class="browser-default custom-select" data-html="true" data-trigger="hover" data-toggle="tooltip" 
							    title="<p>1) Market Basket list<br>2) Order/Invoice detail<br>3) Sparse item Dataset<br>4) Columns with multiple nomimal values</p>"
						    >
								<option value="" disabled selected>Choose a dataset type</option>
								<option value="1">1) Market basket list</option>
								<option value="2">2) Order/Invoice detail</option>
								<option value="3">3) Sparse item dataset</option>
								<option value="4">4) Multiple nomimal values</option>
							</select>
						</div>
					</div>		
					<div class="form-row" id="publicDataset" style="display:none">
						<div class="col-5">
							<label class="col-form-label float-right">Public dataset:</label>
						</div>
						<div class="col-2 mt-1">
                            <label class="switch">
								<input type="checkbox" id="isPublicCheckbox" class="primary">
								<span class="slider round"></span>
	    				    </label>
						</div>
					</div>
				</div>
				<div class="col-1 border border-primary rounded p-1	">
					<button id="uploadDataset" class="btn btn-primary btn-inline p-1 m-0" type="submit" name="submit" style="height:100%; width:100%" id="uploadButton" data-trigger="hover" data-toggle="tooltip" title="Upload the Dataset!"><img src="./images/upload32White.png" class="img-responsive" width="32" height="32" alt=""></button>
				</div>
			</div>
		</div>
	</form>		

	<div id="infoForDS" class="lightgraybackground udfwidth mx-auto border rounded p-2" style="display:none">
		<h2>Supported dataset types</h2>
		<br>
		<p><b>1) Market Basket list.</b> No header is expected, The number of columns is undefined (Default). 
		If header row exists then in 1st parameter of the extra parameters field the string representing the absent item must be declared. If absent item is nothing or not exists then assign "" or "nan".
		The participant columns must be declared in extra parameters field starting from the 2nd parameter.<br> 
		<a href="javascript:toggleDisplay('#hexample1');">Examples</a></p>
		<div id="hexample1" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset with no header line. Nothing must be declared in extra parameters field</b></div>
				<div class="card-body">
					<p class="card-text">
citrus fruit,semi-finished bread,margarine,ready soups<br>
tropical fruit,yogurt,coffee<br>
whole milk<br>
pip fruit,yogurt,cream cheese,meat spreads<br>
other vegetables,whole milk,condensed milk,long life bakery product<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset with header line. If you are interested for the first 8 items then in extra parameters field you must declare: <p style="color:yellow;"><i>"nan" "Item 1" "Item 2" "Item 3" "Item 4" "Item 5" "Item 6" "Item 7" "Item 8"</i></p></b></div>
				<div class="card-body">
					<p class="card-text">Item(s),Item 1,Item 2,Item 3,Item 4,Item 5,Item 6,Item 7,Item 8,Item 9,Item 10,Item 11,Item 12<br>
4,citrus fruit,semi-finished bread,margarine,ready soups,,,,,,,,,,<br>
3,tropical fruit,yogurt,coffee,,,,,,,,,,,,,<br>
1,whole milk,,,,,,,,,,,,<br>
4,pip fruit,yogurt,cream cheese,meat spreads,,,,,,,,,,,,,,,<br>
4,other vegetables,whole milk,condensed milk,long life bakery product,,,,,,,,,,,,,,,,,,<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>2) Order/Invoice detail.</b> Header line is mandatory in that type. Number of columns is fixed in the dataset. 
		In extra parameters field, 1st parameter represents the primary key column while 2nd parameter represents the items column and are both mandatory.<br>
		<a href="javascript:toggleDisplay('#hexample2');">Example</a></p>
		<div id="hexample2" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset of invoice type. In extra parameters field you can declare:
					<p style="color:yellow;"><i>"InvoiceNo" "StockCode"</i></p> or <p style="color:yellow;"><i>"InvoiceNo" "Description"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
InvoiceNo;StockCode;Description;Quantity;InvoiceDate;UnitPrice;CustomerID<br>
536365;85123A;WHITE HANGING HEART T-LIGHT HOLDER;6;1/12/2010 8:26;2,55;17850<br>
536365;71053;WHITE METAL LANTERN;6;1/12/2010 8:26;3,39;17850<br>
536365;84406B;CREAM CUPID HEARTS COAT HANGER;8;1/12/2010 8:26;2,75;17850<br>
536365;84029G;KNITTED UNION FLAG HOT WATER BOTTLE;6;1/12/2010 8:26;3,39;17850<br>
536366;22633;HAND WARMER UNION JACK;6;1/12/2010 8:28;1,85;17850<br>
536366;22632;HAND WARMER RED POLKA DOT;6;1/12/2010 8:28;1,85;17850<br>
536367;84879;ASSORTED COLOUR BIRD ORNAMENT;32;1/12/2010 8:34;1,69;13047<br>
536367;22745;POPPY'S PLAYHOUSE BEDROOM ;6;1/12/2010 8:34;2,1;13047<br>
536367;22748;POPPY'S PLAYHOUSE KITCHEN;6;1/12/2010 8:34;2,1;13047<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>3) Sparse item Dataset.</b> Header line is mandatory in that type of dataset and the number of columns/items is fixed. 
		Item columns are mandatory to be declared from the 2nd parameter and above in extra parameters field.
		In 1st parameter, the string of absent item must be declared!!! If absent item is nothing then assign '' or 'nan'. <br>
		<a href="javascript:toggleDisplay('#hexample3');">Examples</a></p>
		<div id="hexample3" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>1st sample. In extra parameters field you could declare:
					<p style="color:yellow;"><i>"?" "d1" "d2" "diapers" "d4" "beers" "d6" "d7" "d8" "d9" "grocery" "d11" "baby needs" "bread" "coupons" "juice"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
d1,d2,d3,d4,d5,d6,d7,d8,d9,grocery,d11,baby needs,bread,coupons,juice,...<br>
?,?,?,?,?,?,?,?,?,?,?,t,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,...<br>
?,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,t,?,?,?,t,?,?,?,?,?,t,t,?,t,...<br>
t,?,?,?,?,?,?,?,?,?,?,?,t,t,?,t,...<br>
?,?,?,?,?,?,?,?,?,?,?,t,t,t,?,t,...<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>2nd sample. In extra parameters field you could declare:
					<p style="color:yellow;"><i>"0" "air fresheners candles" "asian foods" "baby accessories" "baby bath" "body care"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
order_id,pay_method,arrival_timestamp,air fresheners candles,asian foods,baby accessories,baby bath body care,...<br>
930878,2,0:00:22,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
149444,2,0:02:45,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
327583,1,0:03:17,3,0,0,0,0,0,1,4,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
576050,2,0:03:33,3,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,6,0,0,0,0,0,0,0,0,0,0,0,0,0,...<br>
200249,1,0:03:59,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,...<br>
608770,2,0:04:29,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,...<br>
...<br></p>
				</div>
			</div>
		</div>
		<p><b>4) Columns with multiple categorized values.</b> Header line is optional. 
		Number of columns is fixed, optionally, items columns are expected in extra parameters field in case that header line exists.<br>
		<a href="javascript:toggleDisplay('#hexample4');">Example</a></p>
		<div id="hexample4" style="display:none">
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset without header. Nothing must be declared in extra parameters field.</b></div>
				<div class="card-body">
					<p class="card-text">
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,no<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
...<br></p>
				</div>
			</div>
			<div class="card text-white bg-secondary mb-3">
				<div class="card-header"><b>Sample of dataset with header. In extra parameters field you could declare:					
					<p style="color:yellow;"><i>"class" "age" "sex" "survived"</i></p>
				</b></div>
				<div class="card-body">
					<p class="card-text">
class,age,sex,survived<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,yes<br>
1st,adult,male,no<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
1st,adult,female,yes<br>
...<br></p>
				</div>
			</div>
		</div>
		<br>
		<div class="bg-warning rounded"><b>Note:</b> In extra parameters, the items must be enclosed in double quotes and be seperated with space (e.g. <b><i>"InvoiceID" "ProductID"</i></b>)</div>
	</div>

	<form id="retrieveRules" action="phpfunctions/retrieveRules.php" method="post" >
		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="form-row">
				<div class="col-9">	
					<label style="position:absolute;bottom:0" for="dataset">Select dataset or <a href="#" onclick="toggleDisplay('#uploadDatasetform');return false;" data-toggle="tooltip" title="Upload a new dataset on our server">upload</a> one:</label>			
				</div>
				<div class="col-2">	
					<label style="position:absolute;bottom:0" for="separator">Separator</label>			
				</div>
      		    <div class="col-1">
					<button type="button" class="btn mt-n1 float-right"  onclick="toggleDisplay('#infoForDS')" id="helpForDatasetType" data-trigger="hover" data-toggle="tooltip" title="Information for the dataset type"><img src="./images/help24grey.png" width="24" height="24" alt="">	</button>
				</div>
			</div>
			<div class="form-row">
				<div class="col-9">	
					<select id="dataset" name="dataset" class="form-control browser-default custom-select" data-html="true" data-trigger="hover" data-toggle="tooltip" title="Pick a dataset for which association rules would be generated.<br>Datasets in blue background are public" onchange="retrieveInputParameters()">
						<option value="" disabled selected>Choose a dataset from the list</option>
					</select>
				</div>	
				<div class="col-2">	
					<input type="text" id="separator" name="separator" class="form-control" data-trigger="hover" data-toggle="tooltip" title="the separator of the items in the CSV file. The most common characters are (,) and (;)" placeholder=",">		
				</div>
				<div class="col-1">	
					<button type="button" id="downloadDataset" class="btn mt-n2 float-right" onclick="DoDownload('dataset')"    data-trigger="hover" data-toggle="tooltip" title="Download current dataset">
						<img src="./images/downArrow24grey.png" width="24" height="24" alt="">	
					</button>
					<button type="button" id="deleteDataset"   class="btn mt-n1 float-right" onclick="deletecurrentDataset()" data-trigger="hover" data-toggle="tooltip" title="Delete current dataset" >
						<img src="images/delete32grey.png" width="24" height="24" alt="">
					</button>
				</div>
			</div>	
		</div>
		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="form-row">
				<div class="col-6">		
					<label for="min_support">Minimum support</label>
				</div>
				<div class="col-6">
					<label for="min_confidence">Minimum confidence</label>
				</div>
			</div>
			<div class="form-row">
				<div class="col-6">		
					<input type="text" id="min_support" name="min_support" class="form-control" data-trigger="hover" data-toggle="tooltip" title="The minimum support that each association rule should have" placeholder="0.01">
				</div>
				<div class="col-6">	
					<input type="text" id="min_confidence" name="min_confidence" class="form-control" data-trigger="hover" data-toggle="tooltip" title="The minimum confidence that each association rule should have" placeholder="0.2">
				</div>
			</div>
			<div class="form-row">
				<div class="col-6">		
					<label for="min_lift">Minimum lift</label>
				</div>
				<div class="col-6">
					<label for="max_length">Maximum rules items</label>
				</div>
			</div>
			<div class="form-row">
				<div class="col-6">		
					<input type="text" id="min_lift" name="min_lift" class="form-control" data-trigger="hover" data-toggle="tooltip" title="The minimum lift that each association rule should have" placeholder="1.5">
				</div>
				<div class="col-6">	
					<input type="text" id="max_length" name="max_length" class="form-control" data-trigger="hover" data-toggle="tooltip" title="The maximum items each association rule consist of" placeholder="4">
				</div>
			</div>	
			<div class="form-col">	
				<label for="extra parameters">Extra parameters / item names</label>
			</div>
			<div class="form-col">	
				<input type="text" id="extra_parameters" name="extra_parameters" class="form-control" data-trigger="hover" data-toggle="tooltip" title="In extra parameters, the items must be enclosed in double quotes and be seperated with space. For more details please press ?" placeholder="special data (e.g item names)">
			</div>
			<div class="p-1 mt-2 mx-auto border border-primary rounded" style="width:220px">
				<button id="submitBtn" type="submit" class="btn btn-primary btn-inline" style="height:100%; width:100%">Retrieve association rules</button>
			</div>
		</div>	
	</form>

	<br>
	<br>

	<div id="showResults" class="table-responsive dataTables_wrapper dt-bootstrap4 " style="display: none">

		<div class="lightgraybackground udfwidth mx-auto border rounded p-2">
			<div class="row">
				<div class="col-6">		
					<label for="Records">Records count</label>
				</div>
				<div class="col-4">
					<label for="RecordsCreationTime">Dataset read Time</label>
				</div>
				<div class="col-2">
					<button type="button" class="btn mt-n2 float-right" onclick="DoDownload()" id="helpForDatasetType" data-trigger="hover" data-toggle="tooltip" title="Download association rules in a json format file"><img src="./images/downArrow24grey.png" width="24" height="24" alt="">	</button>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="Records" readonly class="form-control" data-trigger="hover" data-toggle="tooltip" title="Dataset records count">
				</div>
				<div class="col-6">	
					<input type="text" id="RecordsCreationTime" readonly class="form-control" data-trigger="hover" data-toggle="tooltip" title="Time spend (in seconds) for retrieving dataset records">
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<label for="RulesCount">Association rules retrieved</label>
				</div>
				<div class="col-6">
					<label for="RulesCreationTime">Rules retrieval time</label>
				</div>
			</div>
			<div class="row">
				<div class="col-6">		
					<input type="text" id="RulesCount" readonly class="form-control" data-trigger="hover" data-toggle="tooltip" title="Retrieved association rules count">
				</div>
				<div class="col-6">	
					<input type="text" id="RulesCreationTime" readonly class="form-control" data-trigger="hover" data-toggle="tooltip" title="Time spend for retrieving the association rules">
				</div>
			</div>	
		</div>	

		<table id="showResultsTbl" class="table table-striped table-bordered table-hover table-sm" style="width:100%">
			<thead class="thead-dark">
			</thead>
		</table>
	</div>
	
	<br>
	<br>
	<br>
	
	<footer>
        <nav id="c-footer" class="navbar fixed-bottom navbar-expand-lg navbar-dark bg-dark">
            <span class="text-muted">WebApriori Association rules mining based on Apriori algorithm &middot; MSc in Web Intelligence &copy; 2019-2020</span>
        </nav>
	</footer> 

</body>
</html>
